
## 1. What is a Domain Event?

ุจุจุณุงุทุฉุ **Domain Event** ูู ุดูุก ููู ูู ูุฌูุฉ ูุธุฑ ุงูู Business ูุฏ **ุญุฏุซ ุจุงููุนู** ุฏุงุฎู ุงููุธุงู.

### ุงูุฎุตุงุฆุต ุงูุฌููุฑูุฉ:

1. **ุญุฏุซ ูู ุงููุงุถู:** ุฏุงุฆูุงู ูุนุจุฑ ุนูู ุจุตูุบุฉ ุงููุงุถู (e.g., `SubscriptionDeleted` ูููุณ `DeleteSubscription`).
    
2. **ุฃูููุฉ ุจูุฒูุณ:** ููุณ ูุฌุฑุฏ ุชูุตูู ุชููู (ูุซู "ุชู ุงูููุฑ ุนูู ุฒุฑ")ุ ุจู ุชุบููุฑ ูู ุญุงูุฉ ุงููุธุงู ููู ุงูุจูุฒูุณ.
    

### ุงููุซุงู ุงูุนููู: ุญุฐู ุงูุงุดุชุฑุงู (Deleting a Subscription)

ุชุฎูู ุนูููุฉ ุญุฐู ุงุดุชุฑุงู ููุฏูุฑ ุฌูู. ูุฐู ุงูุนูููุฉ ุชุชุทูุจ ุณูุณูุฉ ูู ุงูุฅุฌุฑุงุกุงุช:

1. ุญุฐู ุงูุงุดุชุฑุงู ููุณู.
    
2. ุญุฐู ุฌููุน ุงูุฌููุงุช ุงูุชุงุจุนุฉ ูู.
    
3. ุญุฐู ุงูุบุฑู ูุงูุฌูุณุงุช ุฏุงุฎู ุชูู ุงูุฌููุงุช.
    

**ูู ุงูุฃุณููุจ ุงูุชูููุฏู (Orchestration):**

ููุง ููุชุจ ููุฏุงู ุทูููุงู ูู ุงูู Handler ูููู: "ุงุญุฐู ุงูุงุดุชุฑุงูุ ุซู ุงุญุฐู ุงูุฌูู 1ุ ุซู ุงูุฌูู 2ุ ุซู ุงูุบุฑูุฉ..." ุฎุทูุฉ ุจุฎุทูุฉ.

**ูู ุฃุณููุจ Domain Events:**

1. ุงูู Admin ูููู ุจุญุฐู ุงูุงุดุชุฑุงู.
    
2. ุจูุฌุฑุฏ ุงูุญุฐูุ ูุทูู ุงููุธุงู "ุตุฑุฎุฉ" ุฃู ุญุฏุซ: **"ูุง ุฌูุงุนุฉุ ุชู ุญุฐู ุงุดุชุฑุงู!" (`SubscriptionDeleted`)**.
    
3. ุฃุฌุฒุงุก ุงููุธุงู ุงูุฃุฎุฑู (Event Handlers) ุชุณูุน ูุฐู ุงูุตุฑุฎุฉ ูุชุชุตุฑู ุจูุงุกู ุนูููุง (ูุซู ุญุฐู ุงูุฌููุงุช ุงููุฑุชุจุทุฉ) ุจุดูู ูููุตู.
    

---

## 2. The Tactical Pattern: How it Works?

ุขููุฉ ุนูู ูุฐุง ุงูููุท ุฏุงุฎู **Clean Architecture** ุชุชููู ูู ุซูุงุซ ูุฑุงุญู:

### ุงููุฑุญูุฉ 1: ุงูุงูุชูุงุท (Capture) ๐ธ

ุนูุฏูุง ูุญุฏุซ ุชุบููุฑ ูู ุงูู Domain Object (ูุซู `admin.DeleteSubscription()`):

- ูุง ูููู ุจุชูููุฐ ุงูุขุซุงุฑ ุงูุฌุงูุจูุฉ (Side Effects) ููุฑุงู.
    
- ุจุฏูุงู ูู ุฐููุ ูุถูู "ุญุฏุซุงู" (`new SubscriptionDeletedEvent`) ุฅูู **ูุงุฆูุฉ ุฏุงุฎููุฉ** ูู ูุงุฆู ุงูู Admin.
    
- ูุฐุง ุงูุญุฏุซ ูุจูู "ูุงุฆูุงู" ูู ุงูุฐุงูุฑุฉ ูุคูุชุงู.
    

### ุงููุฑุญูุฉ 2: ุงูุญูุธ (Persist) ๐พ

ุนูุฏูุง ููุงุฏู `SaveChangesAsync` ูุญูุธ ุงูุชุบููุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

- ูุชู ุญูุธ ุญุงูุฉ ุงูู Admin ุงูุฌุฏูุฏุฉ (ุจุฏูู ุงุดุชุฑุงู).
    
- **ููุท ุจุนุฏ ูุฌุงุญ ุงูุญูุธ**ุ ูููู ุจูุดุฑ (Publish) ุงูุฃุญุฏุงุซ ุงููุงุฆูุฉ. ูุฐุง ูุถูู ุนุฏู ุฅุทูุงู ุฃุญุฏุงุซ ูุนูููุงุช ูุดูุช ูู ุงูุชุฎุฒูู.
    

### ุงููุฑุญูุฉ 3: ุงูุชูุงุนู (React) โก

ุจูุฌุฑุฏ ูุดุฑ ุงูุญุฏุซ:

- ูุณุชูุจูู ูุงุญุฏ ุฃู ุฃูุซุฑ ูู **Event Handlers**.
    
- ูููู ูู Handler ุจุชูููุฐ ููุทู ูุนูู (ุญุฐู ุฌููุงุชุ ุฅุฑุณุงู ุฅููููุ ุฅูุฎ).
    
- **ููุงุญุธุฉ ูููุฉ:** ุงูุนูุงูุฉ ููุง ูู **One-to-Many**. ุญุฏุซ ูุงุญุฏ ูููู ุฃู ูุทูู ุนุฏุฉ Handlers.
    

---

## 3. Implementation Steps: Setting the Foundation

ููุจุฏุฃ ุจูุชุงุจุฉ ุงูููุฏ ุงูุชุฃุณูุณู ููุฐุง ุงูููุท ูู ุทุจูุฉ **Domain Layer**.

### Step 1: Create the Event Class

ูู ูุดุฑูุน ุงูู Domainุ ููุดุฆ ูุฌูุฏ `Events` ุฏุงุฎู `Admin` ููุนุฑู ุงูุญุฏุซ:



```C#
// Domain/Admin/Events/SubscriptionDeletedEvent.cs
public record SubscriptionDeletedEvent(Guid SubscriptionId) : IDomainEvent;
```

- ูุณุชุฎุฏู `record` ูุฃูู ููุซู ุจูุงูุงุช ุซุงุจุชุฉ (Immutable).
    
- ูุญุชูู ุนูู ุงูุจูุงูุงุช ุงูุถุฑูุฑูุฉ ููุท (ูุซู `SubscriptionId`).
    

### Step 2: Define `IDomainEvent` & MediatR Integration

ููู ูุชููู ูู ูุดุฑ ุงูุฃุญุฏุงุซ ุจุณูููุฉุ ุณูุนุชูุฏ ุนูู ููุชุจุฉ **MediatR** ุงูุชู ุชุฏุนู ููุท Publisher/Subscriber.

1. ูุถูู ููุชุจุฉ `MediatR` ููุดุฑูุน **Domain**.
    
2. ูุนุฑู ูุงุฌูุฉ `IDomainEvent` ุงูุชู ุชุฑุซ ูู `INotification` (ุงูุฎุงุตุฉ ุจู MediatR):
    



```C#
// Domain/Common/IDomainEvent.cs
using MediatR;

public interface IDomainEvent : INotification
{
}
```

### Step 3: Base Entity with Event List

ูุญุชุงุฌ ูููุงู ูุชุฎุฒูู ุงูุฃุญุฏุงุซ "ุงููุงุฆูุฉ" ูู ูู Entity. ุจุฏูุงู ูู ุชูุฑุงุฑ ุงููุงุฆูุฉ ูู ูู ููุงุณุ ููุดุฆ **Base Class**:



```C#
// Domain/Common/Entity.cs
public abstract class Entity
{
    public Guid Id { get; init; } // Init-only for immutability

    // ุงููุงุฆูุฉ ุงูุฏุงุฎููุฉ ูุชุฎุฒูู ุงูุฃุญุฏุงุซ
    private readonly List<IDomainEvent> _domainEvents = new();

    // ุฎุงุตูุฉ ูููุตูู ููุฃุญุฏุงุซ (ูููุดุฑ ูุงุญูุงู)
    public IReadOnlyList<IDomainEvent> DomainEvents => _domainEvents.AsReadOnly();

    protected Entity(Guid id)
    {
        Id = id;
    }

    // ูููุณุชุฑูุชูุฑ ูุงุฑุบ ูู EF Core
    protected Entity() { }

    // ุฏุงูุฉ ูุฅุถุงูุฉ ุญุฏุซ ูููุงุฆูุฉ
    protected void AddDomainEvent(IDomainEvent domainEvent)
    {
        _domainEvents.Add(domainEvent);
    }

    // ุฏุงูุฉ ููุณุญ ุงูุฃุญุฏุงุซ ุจุนุฏ ูุดุฑูุง
    public void ClearDomainEvents()
    {
        _domainEvents.Clear();
    }
}
```

### Step 4: Update the Admin Entity

ุงูุขู ูุฌุนู `Admin` ูุฑุซ ูู `Entity` ููุณุชุฎุฏู ุงูุขููุฉ ุงูุฌุฏูุฏุฉ:



```C#
// Domain/Admin/Admin.cs
public class Admin : Entity
{
    public void DeleteSubscription(Guid subscriptionId)
    {
        // 1. Perform the business logic (removing subscription)
        SubscriptionId = null;

        // 2. Capture the event
        AddDomainEvent(new SubscriptionDeletedEvent(subscriptionId));
    }
}
```

**ุงููุชูุฌุฉ:** ุงูุขู ุงูู Admin ูููู ููุท ุจุชุณุฌูู ุฃู "ุงูุงุดุชุฑุงู ุญูุฐู"ุ ุฏูู ุฃู ููุชู ุจูู ุณูููู ุจุชูุธูู ุงูุฌููุงุช ุฃู ุฅุฑุณุงู ุงูุฅููููุงุช. ูุฐุง ูุญูู **Decoupling** (ูุตู) ููุชุงุฒ ุจูู ุฃุฌุฒุงุก ุงููุธุงู.

_ูู ุงูุฏูุนุฉ ุงููุงุฏูุฉุ ุณูุฑู ููู ุณูุชู ูุดุฑ ูุฐู ุงูุฃุญุฏุงุซ ุชููุงุฆูุงู ุนูุฏ ุงูุญูุธุ ูููููุฉ ุงูุชุนุงูู ูุน ุงูู Side Effects._


