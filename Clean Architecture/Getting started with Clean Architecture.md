

### 1. ุงููุดููุฉ ูู ุงูุนูุงุฑุฉ ุงูุทุจููุฉ ุงูุชูููุฏูุฉ (3-Tier Architecture)

ูู ุงููุธุงู ุงูุชูููุฏูุ ูููู ูุฏููุง 3 ุทุจูุงุช:

1. **Presentation Layer:** (ูุงุฌูุฉ ุงููุณุชุฎุฏูุ Controllers).
    
2. **Business Logic Layer:** (ููุงุนุฏ ุงูุนูู).
    
3. **Data Access Layer:** (ุงูุชุนุงูู ูุน ุงูุฏุงุชุงุจูุณ).
    

- **ุงููุดููุฉ ุงููุจุฑู:** ุงุชุฌุงู ุงูุฃุณูู (Dependencies) ููู ูุดูุฑ ููุฃุณูู ูุญู **ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database)**.
    
- **ุงููุชูุฌุฉ:** ุงูู Presentation ูุนุชูุฏ ุนูู ุงูู Logicุ ูุงูู Logic ูุนุชูุฏ ุนูู ุงูู Data. ูุฐุง ูุฌุนู ุงูุชุทุจูู **Database-Centric** (ูุชูุญูุฑ ุญูู ุงูุจูุงูุงุช). ุฅุฐุง ุบูุฑุช ุงูุฏุงุชุงุจูุณุ ูุฏ ูููุงุฑ ุงูููุฌููุ ููุฏ ุชุชุฃุซุฑ ุงููุงุฌูุฉ.
    

### 2. ุงูุญู: ุงูุนูุงุฑุฉ ุงููุชูุญูุฑุฉ ุญูู ุงูุฏูููู (Domain-Centric Architecture)

ุงููุฏู ูู ููุจ ุงูููุงุฒูู: ุฌุนู **Business Logic** ูู ุงูููู (ูู ุงูููุชุตู)ุ ูููุณ ุงูุฏุงุชุงุจูุณ.

- ุฃุดูุฑ ุงูุฃููุงุน: Clean Architectureุ Hexagonal (Ports & Adapters)ุ ู Onion Architecture. (ูููุง ุชุชุดุงุฑู ููุณ ุงููุจุฏุฃ).
    

### 3. ูุง ูู ุงูู Clean Architectureุ

ูู ูููููุฉ ุชุถุน ุงูู **Business Logic** ูู ูุฑูุฒ ุงูุฏุงุฆุฑุฉุ ูุจุงูู ุงูุฃุดูุงุก (UI, Database, Frameworks) ุชููู ูู ุงูุทุจูุงุช ุงูุฎุงุฑุฌูุฉ.

**ุชูููู ุงูู Core (ุงูููุจ):**

ุงูููุจ ูุชููู ูู ุทุจูุชูู ุฃุณุงุณูุชูู (ููุฐุง ูุง ุณูุทุจูู ูู ุงูู ASP.NET Core):

- **Domain Layer:** ุงูููุงูุงุช ุงูุฃุณุงุณูุฉ (Entities).
    
- **Application Layer:** ุญุงูุงุช ุงูุงุณุชุฎุฏุงู (Use Cases).
    

### 4. ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ (The Dependency Rule) โ๏ธ

ูุฐู ุฃูู ููุทุฉ ูู ุงูููุฏูู ูุงูููุฑุณ ุจุงููุงูู:

> **"ุงูุฃุณูู (Dependencies) ุชุดูุฑ ููุท ุฅูู ุงูุฏุงุฎู (Inwards)."**

- ุงูุทุจูุงุช ุงูุฏุงุฎููุฉ (Core) **ูุง ุชุนูู ุดูุฆุงู** ุนู ุงูุทุจูุงุช ุงูุฎุงุฑุฌูุฉ (Infrastructure/Presentation).
    
- ุงูู Infrastructure ูุนุชูุฏ ุนูู ุงูู Coreุ ูููุณ ุงูุนูุณ.
    

### 5. ุงูุณุญุฑ: ููู ูุชุนุงูู ุงูู Core ูุน ุงูุฏุงุชุงุจูุณ ุฏูู ุฃู ูุนุชูุฏ ุนูููุงุ

ุณุฃู ุงููุญุงุถุฑ ุณุคุงูุงู ุฐููุงู: _"ููู ูููู ููู Business Logic ุฃู ูุญูุธ ุงูุจูุงูุงุช ูู ุงูุฏุงุชุงุจูุณ ููู ููููุน ูุนุชูุฏ ุนูููุงุ"_

- **ุงูุญู ุงูุชููู:** ุจุงุณุชุฎุฏุงู **Interfaces** (ุงููุงุฌูุงุช).
    
    1. ูููู ุจุชุนุฑูู `Interface` ุฏุงุฎู ุงูู **Application Layer** (ูุซูุงู `IUserRepository`).
        
    2. ูููู ุจูุชุงุจุฉ ุงูููุฏ ุงููุนูู (Implementation) ุฏุงุฎู ุงูู **Infrastructure Layer**.
        
    3. ูู ููุช ุงูุชุดุบูู (Runtime)ุ ูุชู ุญูู ุงูููุฏ ุงููุนูู.
        

---

### ุฌุฏูู ููุงุฑูุฉ ุณุฑูุน (ููุชุฑุณูุฎ):

|**ูุฌู ุงูููุงุฑูุฉ**|**Layered Architecture (ุงููุฏูู)**|**Clean Architecture (ุงูุฌุฏูุฏ)**|
|---|---|---|
|**ุงููุฑูุฒ**|Database (ูุงุนุฏุฉ ุงูุจูุงูุงุช)|Domain (ููุงุนุฏ ุงูุนูู)|
|**ุงุชุฌุงู ุงูุงุนุชูุงุฏูุฉ**|ููู ููุฃุณูู (ูุญู ุงูุฏุงุชุงุจูุณ)|ููู ููุฏุงุฎู (ูุญู ุงูุฏูููู)|
|**ุณูููุฉ ุงูุชุบููุฑ**|ุตุนุจุฉ (ุชุบููุฑ ุงูู DB ูุคุซุฑ ุนูู ุงููู)|ุณููุฉ (ุงูู DB ูุฌุฑุฏ ุชูุตูู ุฎุงุฑุฌู)|
|**ูุงุจููุฉ ุงูุงุฎุชุจุงุฑ (Testing)**|ุตุนุจุฉ (ุงูุชุฏุงุฎู ูุจูุฑ)|ููุชุงุฒุฉ (ูููู ุงุฎุชุจุงุฑ ุงูููุฌูู ุจูุนุฒู)|

---










### 1. ููููุฉ ุงููุดุงุฑูุน (Solution Setup)

ุชู ุฅูุดุงุก 4 ูุดุงุฑูุน ุฃุณุงุณูุฉ ุฏุงุฎู ุงูู Solutionุ ููู ูุดุฑูุน ููุซู ุทุจูุฉ:

- **GymManagement.Api:** ููุนู `webapi` (ูุฐุง ูู ุงููุญูุฏ ุงูุฐู ููุณ Class Library ูุฃูู ุงููุดุบู ููุชุทุจูู).
    
- **GymManagement.Application:** ููุนู `classlib` (ููุชุจุฉ ุฃููุงุฏ).
    
- **GymManagement.Infrastructure:** ููุนู `classlib`.
    
- **GymManagement.Domain:** ููุนู `classlib`.
    
- **GymManagement.Contracts:** ูุดุฑูุน ุฅุถุงูู ููุดุฑ ุงูู DTOs (ุงูุทูุจุงุช ูุงูุงุณุชุฌุงุจุงุช) ูููุชุจุฉ ูุณุชููุฉ.
    

### 2. ุฅุฏุงุฑุฉ ุงูุงุนุชูุงุฏุงุช (Project References) ๐

ูุฐู ุฃูู ุฎุทูุฉ ูุชุทุจูู ููุงุนุฏ ุงูู Clean Architecture ุจุฑูุฌูุงูุ ุจุญูุซ ูุง ูุณูุญ ูู ุงูููุฌูุงู ุณุชูุฏูู ุจูุณุฑ ุงูููุงุนุฏ:

- **ุงูู API** ูุนุชูุฏ ุนูู **Application** ู **Contracts**.
    
- **ุงูู Infrastructure** ูุนุชูุฏ ุนูู **Application**.
    
- **ุงูู Application** ูุนุชูุฏ ุนูู **Domain**.
    
- **ุงูู Domain** ูุง ูุนุชูุฏ ุนูู ุดูุก (ูุณุชูู ุชูุงูุงู).
    

### 3. ูุธููุฉ ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer)

ุงููุญุงุถุฑ ุฑูุฒ ุนูู ุฃู ูุธููุฉ ูุฐู ุงูุทุจูุฉ (ุงูุชู ูู ุงูู API ูู ุญุงูุชูุง) ููุณุช ููุท ุงุณุชูุจุงู ุงูุทูุจุงุชุ ุจู:

- **ุงูุชุฑุฌูุฉ (Translation):** ุชุญููู ุงูุจูุงูุงุช ุงููุงุฏูุฉ ูู "ูุบุฉ ุงูููุจ" (HTTP/JSON) ุฅูู "ูุบุฉ ุงูุชุทุจูู" (Domain Entities).
    
- **ุงุณุชููุงู ุงูุนูุฏ (API Contract):** ูุตู ุดูู ุงูู JSON ุงูุฐู ูุฑุงู ุงููุณุชุฎุฏู ุนู ุดูู ุงูู Classes ุงูุฏุงุฎููุฉ. ูุฐุง ูุณูุญ ูู ุจุชุบููุฑ ุงูุฏุงุชุงุจูุณ ุฃู ุงูููุฌูู ุงูุฏุงุฎูู ุฏูู ุฃู ูุถุทุฑ ุงููุณุชุฎุฏู (ุงูููููุช) ูุชุบููุฑ ุงูููุฏ ุนูุฏู.
    

### 4. ูุดุฑูุน ุงูู Contracts (ููุงุฐุง ูู ูููุตูุ)

ุชู ุฅูุดุงุก ูุดุฑูุน ูุณุชูู ููู **Contracts** (ูุญุชูู ุนูู ุงูู Requests ูุงูู Responses):

- **ุงููุฏู:** ููู ุชุชููู ูู ุชุญูููู ุฅูู `NuGet Package`.
    
- **ุงููุงุฆุฏุฉ:** ุฅุฐุง ูุงู ููุงู ูุฑูู ุขุฎุฑ ูุจูู ุชุทุจูู ููุจุงูู ุฃู ูุฑููุช-ุฅูุฏุ ูููููู ุชุญููู ูุฐู ุงูููุชุจุฉ ูุงุณุชุฎุฏุงู ููุณ ุงูู Classes ูุถูุงู ุงูุชูุงูู ูุน ุงูู API ุงูุฎุงุต ุจู ุฏูู ุงูุญุงุฌุฉ ูุฑุคูุฉ ููุฏ ุงูุจุฒูุณ ุฃู ุงูุฏุงุชุงุจูุณ.
    

---

### ุฃุฏูุงุช ูููุฏุฉ ุฐูุฑูุง ุงููุญุงุถุฑ:

- **REST Client (VS Code Extension):** ุจุฏูู ุฎููู ูู Postman ูุณูุญ ูู ุจูุชุงุจุฉ ุทูุจุงุช HTTP ุฏุงุฎู ูููุงุช ุจูุงุญูุฉ `.http` ูุชุดุบูููุง ูุจุงุดุฑุฉ. ูุฐู ุงููููุงุช ูุฏุนููุฉ ุงูุขู ูู Visual Studio 2022 ุฃูุถุงู.
    

---










### 1. ุญุงุฌุฒ ุงูุงุนุชูุงุฏูุฉ (The Dependency Barrier)

ุงููุญุงุถุฑ ูุจู ุนูู ููุทุฉ ุฐููุฉ ุฌุฏุงู ุจุฑูุฌูุงู:

- **ูุดุฑูุน ุงูู API** ูุนุชูุฏ ุนูู **Application** ู **Contracts**.
    
- **ูุดุฑูุน ุงูู Application** ูุง ูุนุชูุฏ ุนูู ุงูู Contracts.
    
- **ุงููุชูุฌุฉ:** ุจูุง ุฃู ุงูู Application ูุง ูุฑู ุงูู Contractsุ ูุฅูู **ูุง ูุณุชุทูุน** ุงุณุชูุจุงู ููุงุณุงุช ุงูู Request (ูุซู `RegisterRequest`) ูุจุงุดุฑุฉ ุฏุงุฎู ุงูู Services ุชุจุนุชู.
    

### 2. ููุงุฐุง ูุฐุง ุงูุชุนููุฏุ (The Purpose)

ูุฏ ูุชุณุงุกู ุงูุจุนุถ: "ููุงุฐุง ูุง ุฃุฌุนู ุงูู Application ูุนุชูุฏ ุนูู ุงูู Contracts ูุฃุฑูุญ ุฑุงุณูุ"

- **ุงูุณุจุจ:** ุงูู Contracts ูู "ูุบุฉ ุงูุนุงูู ุงูุฎุงุฑุฌู" (API)ุ ููู ุนุฑุถุฉ ููุชุบููุฑ ุงููุณุชูุฑ.
    
- **ุงููุงุนุฏุฉ:** ุงูู Core (Application + Domain) ูุฌุจ ุฃู ูุชุญุฏุซ ูุบุฉ ูุงุญุฏุฉ ุซุงุจุชุฉ ููุณุชููุฉ. ุฅุฐุง ุชุบูุฑ ุงูู API (ูุซูุงู ุบููุฑูุง ุงุณู ุญูู ูู ุงูู JSON)ุ ูุง ูุฑูุฏ ุฃู ูุถุทุฑ ูุชุนุฏูู ููุฏ ุงูุจุฒูุณ ูู ุงูู Application.
    

### 3. ุนูููุฉ ุงูุชุญููู (The Transformation)

ูุธููุฉ ุงูู **Presentation Layer (API Project)** ุงูุขู ูู ุฃู ูุนูู ูู "ูุชุฑุฌู":

1. ูุณุชูุจู ุงูุทูุจ ูู `Request Object` (ูู ูุดุฑูุน ุงูู Contracts).
    
2. ูููู ุจุชุญููู (Mapping) ุงูุจูุงูุงุช ูู ุงูู Request ุฅูู **ูุบุฉ ุงูู Application** (ุบุงูุจุงู ุชููู Primitive types ูุซู `string`, `int` ุฃู ููุงุณุงุช ุฏุงุฎููุฉ ุชุณูู **Commands/Queries**).
    
3. ููุฑุฑ ูุฐู ุงูุจูุงูุงุช ููู Application Layer.
    

---

### ูุซุงู ุนููู ุณุฑูุน (C#):

ุชุฎูู ุนูุฏู ุนูููุฉ ุฅุถุงูุฉ ุฌูู ุฌุฏูุฏ ูู ูุดุฑูุนู:

- **ูู ุงูู Controller (Presentation):**
    

C#

```
[HttpPost]
public IActionResult CreateGym(CreateGymRequest request) // ูุฐุง ุงูู Request ูุงุฏู ูู ูุดุฑูุน ุงูู Contracts
{
    // ูุญูู ุงูุจูุงูุงุช ูู ุงูู Request ุฅูู ูุบุฉ ุงูู Application (ููุง ููุฑุฑ ููู ุจุณูุทุฉ)
    var result = _gymService.AddGym(request.Name, request.Location); 
    
    return Ok(result);
}
```

- **ูู ุงูู Service (Application):**
    

C#

```
// ูุงุญุธ ุฃู ูุฐู ุงูุณูุฑูุณ ูุง ุชุนุฑู ุฃู ุดูุก ุนู "CreateGymRequest"
public Guid AddGym(string name, string location) 
{
    // ุชูููุฐ ุงูููุทู ููุง...
    return Guid.NewGuid();
}
```

---

### ุจุงุฎุชุตุงุฑ:

ุงูู **Core** (ุงูุฏูููู ูุงูุฃุจููููุดู) ูู ููุทูุฉ "ููุฏุณุฉ" ูุง ูุฏุฎููุง ุฃู ููุงุณ ุฎุงุฑุฌู. ุฃู ุจูุงูุงุช ุชุฏุฎู ุฅูููุง ูุฌุจ ุฃู ูุชู ุชุฌุฑูุฏูุง ูู ุตูุชูุง ุงูุฎุงุฑุฌูุฉ ูุชุญููููุง ููุบุฉ ุฏุงุฎููุฉ.

**ุงูููุฏูู ุงููุงุฏู ุณูุดุฑุญ ูุณุคูููุงุช ุงูู Application Layer ุจุงูุชูุตูู. ูู ุชุฑูุฏ ุฃู ูุบูุต ูููุง ุงูุขูุ**



---









### 1. ูุง ูู ุญุงูุฉ ุงูุงุณุชุฎุฏุงู (Use Case)ุ

ูู ุฃู ูุนู ุฃู ูููุฉ "ุจุฒูุณ" ูููู ุจูุง ุงููุณุชุฎุฏู ุนูู ุงููุธุงู. ููุฑ ูููุง ูุฃููุง "ููุฒุฉ" (Feature) ุฃู "ูุนู" (Verb) ูู ุชุทุจููู.

- **ุฃูุซูุฉ ูู ุงูููุฑุณ:** `CreateSubscription` (ุฅูุดุงุก ุงุดุชุฑุงู)ุ `AddGym` (ุฅุถุงูุฉ ุฌูู)ุ `DeleteSubscription`.
    
- **ุฃูุซูุฉ ูู ูุดุฑูุนู "Gradify":** `SubmitProject` (ุชุณููู ูุดุฑูุน)ุ `AssignSupervisor` (ุชุนููู ูุดุฑู).
    

### 2. ููู ุชููุฐ ุงูู Application Layer ูุฐู ุงูู Use Casesุ

ุงููุญุงุถุฑ ูุฎุต ุงูุนูููุฉ ูู ุฎุทูุชูู (Orchestration):

1. **ุฌูุจ ูุงุฆูุงุช ุงูุฏูููู (Fetching Domain Objects):**
    
    ุงูุฃุจููููุดู ูุทูุจ ูู ุงูู `Repository` ุฅุญุถุงุฑ ุงูุจูุงูุงุช ูู ุงูุฏุงุชุงุจูุณ. (ูุซูุงู: "ูุง ูุณุชูุฏุนุ ุฃุนุทูู ุจูุงูุงุช ุงูุงุดุชุฑุงู ุฑูู 5").
    
2. **ุงูุชูุงุนุจ ุจูุงุฆูุงุช ุงูุฏูููู (Manipulating Domain Objects):**
    
    ุจุนุฏ ุฌูุจ ุงูุจูุงูุงุชุ ูููู ุงูุฃุจููููุดู ุจููุงุฏุงุฉ ุงูููุฌูู ุงูููุฌูุฏ ุฏุงุฎู ุงูู Domain. (ูุซูุงู: "ูุง ูุงุฆู ุงูุงุดุชุฑุงูุ ุฃุถู ูุฐุง ุงูุฌูู ุงูุฌุฏูุฏ ุฅููู").
    

---

### ูุซุงู ุนููู: ุณููุงุฑูู "ุฅุถุงูุฉ ุฌูู ููุงุดุชุฑุงู" (Add Gym to Subscription)

ุชุฎูู ุงูุชุฏูู ุฏุงุฎู ููุฏ ุงูู **Application Layer**:

1. **ุงููุฏุฎูุงุช:** ุงุณุชูุงู `AddGymCommand` (ูุญุชูู ุนูู `SubscriptionId` ู ุจูุงูุงุช ุงูุฌูู).
    
2. **ุงูุฌูุจ:** ุงุณุชุฏุนุงุก `_subscriptionRepository.GetById(id)`.
    
3. **ุงูุชูููุฐ:** ุฅูุดุงุก ูุงุฆู `Gym` ุฌุฏูุฏ (Domain Model) ูููุงุฏุงุฉ `subscription.AddGym(gym)`.
    
4. **ุงูุญูุธ:** ุงุณุชุฏุนุงุก `_subscriptionRepository.Update(subscription)`.
    

---

### ูุงุนุฏุฉ ุฐูุจูุฉ: "ุงูููุณู ูููุณ ุงููููุฐ" ๐ผ

ูุงุญุธ ุฃู ุงูู Application Layer **ูุง ุชูุฑุฑ** ุฅุฐุง ูุงู ูุณููุญุงู ุฅุถุงูุฉ ุงูุฌูู ุฃู ูุง (ูุฐุง ุดุบู ุงูุฏูููู)ุ ูู ููุท **ุชูุณู** ุงูุนูููุฉ:

- ูู ุชุนุฑู "ูู ุฃูู" ุชุฃุชู ุจุงูุจูุงูุงุช (Repository Interface).
    
- ูู ุชุนุฑู "ูุชู" ุชูุงุฏู ุงูููุฌูู (Domain Method).
    
- ูู ุชุนุฑู "ุฃูู" ุชุญูุธ ุงููุชูุฌุฉ.
    

### ุงูุฎูุงุตุฉ:

ุทุจูุฉ ุงูู **Application** ูู ุงูููุงู ุงูุฐู ุชููุชุจ ููู "ูุตุต ุงููุณุชุฎุฏู" (User Stories) ุนูู ุดูู ููุฏ. ุฅุฐุง ุฃุฑุฏุช ูุนุฑูุฉ ูุงุฐุง ููุนู ุชุทุจูููุ ุงุจุญุซ ูู ูุฐู ุงูุทุจูุฉ.

**ูู ูุงุญุธุช ููู ุฃู ุงูู Application ูุง ูุฒุงู "ูุธููุงู"ุ** ูู ูุง ูุนุฑู ููู ุชุฌูุจ ุงูู Repository ุงูุจูุงูุงุชุ ููุง ูุนุฑู ุชูุงุตูู ููุงููู ุงูุจุฒูุณ ุงููุนูุฏุฉ ุฏุงุฎู ุงูุฏููููุ ูู ููุท "ูุฏูุฑ ุนูููุงุช".



---











### 1. ูู ุทุจูุฉ ุงูู Application (ุงูููุทู)

ุชู ุฅูุดุงุก ูุฌูุฏ ุจุงุณู `Services` ุฏุงุฎูู:

- **ุงููุงุฌูุฉ (Interface):** `ISubscriptionsService` ูุชุนุฑูู "ูุงุฐุง" ูููู ูููุธุงู ุฃู ููุนู.
    
- **ุงูุชูููุฐ (Implementation):** `SubscriptionsService` ูุชุนุฑูู "ููู" ุณูุชู ุฐูู (ุญุงููุงู ูุฑุฌุน `Guid.NewGuid()` ุจุดูู ูุคูุช).
    

### 2. ูู ุทุจูุฉ ุงูู Presentation (ุงูู API)

ุชู ุชุนุฏูู ุงูู `SubscriptionsController` ููููู ุจุนูููุฉ ุงูุฑุจุท:

- **ุญูู ุงูุชุจุนูุฉ (Dependency Injection):** ุทูุจ `ISubscriptionsService` ุนุจุฑ ุงูู Constructor.
    
- **ุงูุชุฑุฌูุฉ (The Mapping):** ุฃุฎุฐ ุงูุจูุงูุงุช ูู ุงูู `Request` (ุงููุงุฏู ูู ูุดุฑูุน ุงูู Contracts) ูุญูููุง ุฅูู ุฃููุงุน ุจุณูุทุฉ (`string` ู `Guid`) ูููุฑุฑูุง ููุณูุฑูุณ.
    
- **ุงูุงุณุชุฌุงุจุฉ:** ุงุณุชูู ุงูู `Id` ุงูุฌุฏูุฏ ูู ุงูุณูุฑูุณุ ูุถุนู ูู ูุงุฆู `SubscriptionResponse` ูุฃุฑุฌุนู ูููุณุชุฎุฏู.
    

---

### ููุงุญุธุงุช ุชูููุฉ ูุงูุฉ ุฐูุฑูุง ุงููุญุงุถุฑ:

#### ุฃ. ุญูุงูุฉ ุงูู Core ุจุงูู Project References

ูุงุญุธุช ุฃู ุงููุญุงุถุฑ ุญุงูู ุชูุฑูุฑ `SubscriptionType` (ุงูุฐู ูู Enum ุฏุงุฎู ูุดุฑูุน ุงูู Contracts) ุฅูู ุงูุณูุฑูุณ ููุดูุ

- **ุงูุณุจุจ:** ูุดุฑูุน ุงูู Application ูุง ูุฑู ุงูู Contracts.
    
- **ุงููุงุฆุฏุฉ:** ูุฐุง "ุฅุฌุจุงุฑ ุจุฑูู" ูู ููู ูุง ุชูุณุฑ ููุงุนุฏ ุงูู Clean Architecture. ุฃูุช ูุถุทุฑ ูุชุญููู ุงูุจูุงูุงุช ูุจู ุฅุฑุณุงููุง ููู Application.
    

#### ุจ. ุงูู Mapping ุงููุฏูู

ุญุงููุงูุ ุงูุชุญููู ูุชู ูุฏููุงู ุฏุงุฎู ุงูู Controller (ุฃุฎุฐ ููู ูู ุงูู Request ููุถุนูุง ูู ุงูู Method). ูุงุญูุงู ูู ุงูููุฑุณุ ุณูุชู ุงุณุชุฎุฏุงู **CQRS** ู **MediatR** ูุฌุนู ูุฐู ุงูุนูููุฉ ุฃูุซุฑ ุงุญุชุฑุงููุฉ ูุชูุธููุงู.

---

### ุงููุดููุฉ (The Error): "Unable to resolve service..." โ

ุนูุฏ ุชุดุบูู ุงูููุฏุ ุธูุฑ ุฎุทุฃ ูุฃู ุงูู ASP.NET Core ูุง ูุนุฑู ุฃู ููุงุณ ููุซู `ISubscriptionsService`.

- ูุฐุง ูุชุทูุจ ุชุณุฌูู ุงูุณูุฑูุณ ูู ุญุงููุฉ ุงูู **Dependency Injection (DI)**.
    
- ุงููุญุงุถุฑ ูู ูุถุน ุงูููุฏ ูู `Program.cs` ูุจุงุดุฑุฉุ ุจู ุฃููุญ ุฅูู ุทุฑููุฉ ุฃูุซุฑ ูุธุงูุฉ ูุชุฑุชูุจ "ุญูู ุงูุชุจุนูุงุช" ููู ูุดุฑูุน ุนูู ุญุฏุฉ.
    

---

### ุณุคุงู ูู ููุฑู ูุฏู ุงุณุชูุนุงุจู ููููุทุฉ ุงูุฃุฎูุฑุฉ:

ูู ููุช ุชุฑูุฏ ุชุณุฌูู ูุฐู ุงูุณูุฑูุณุ ูู ุชูุถู ูุถุน ููุฏ ุงูุชุณุฌูู ุฏุงุฎู ูุดุฑูุน ุงูู **API** ูุจุงุดุฑุฉ (ูู ููู `Program.cs`) ุฃู ุชูุถู ุฃู ูููู ููู ูุดุฑูุน (ูุซู Application) ููู ุฅุนุฏุงุฏุงุช ุฎุงุต ุจู ูุฎุจุฑ ุงูู API ุจูุง ูุฏูู ูู ุฎุฏูุงุชุ



---








### 1. ุงููุดููุฉ ูู ุงูุทุฑููุฉ ุงูุชูููุฏูุฉ

ุนุงุฏุฉูุ ูููู ุจุชุณุฌูู ูู ุงูุฎุฏูุงุช (Services) ุฏุงุฎู ููู `Program.cs`.

- **ุงููุดููุฉ:** ูุน ููู ุงููุดุฑูุนุ ุณูุตุจุญ ููู `Program.cs` ุถุฎูุงู ุฌุฏุงู ููููุฆุงู ุจุงูุชูุงุตูู (ุฏุงุชุงุจูุณุ ุฅููููุ ููุฌููุ ุฅูุฎ).
    
- **ุงูุฃุฎุทุฑ:** ุณูุชุนูู ุนูู ูุฑูู ุงูู Infrastructure ุชุนุฏูู ููู ูู ุทุจูุฉ ุงูู Presentation ูููุง ุฃุถุงููุง ููุฒุฉ ุฌุฏูุฏุฉุ ููุฐุง ููุณุฑ ุงุณุชููุงููุฉ ุงูุทุจูุงุช.
    

### 2. ุงูุญู: "ูู ุทุจูุฉ ูุณุคููุฉ ุนู ููุณูุง"

ูุงู ุงููุญุงุถุฑ ุจุฅูุดุงุก ููุงุณ ุณุชุงุชูู ูู ูู ุทุจูุฉ (Application ู Infrastructure) ูุณูู `DependencyInjection`:

- ูุญุชูู ุนูู **Extension Method** (ูุซู `AddApplication` ู `AddInfrastructure`).
    
- ุทุจูุฉ ุงูู API ุชููู ููุท ุจุงุณุชุฏุนุงุก ูุฐู ุงูุฏูุงู ูู ุณุทุฑ ูุงุญุฏ.
    

### 3. ุงูุชุญุฏู ุงูุชููู (NuGet Packages)

ูุดุฑูุน ุงูู Application ูู "ููุชุจุฉ ุฃููุงุฏ" (Class Library) ุจุณูุทุฉุ ููุง ุชุนุฑู ูุง ูู ุงูู `IServiceCollection`.

- **ุงูุญู:** ุฅุถุงูุฉ ุญุฒูุฉ `Microsoft.Extensions.DependencyInjection.Abstractions`. ูุงุญุธ ุฃูู ุฃุถุงู ุงูู **Abstractions** ููุท ููุจูู ุงููุดุฑูุน ุฎูููุงู ููุง ูุนุชูุฏ ุนูู "ูู" ุงููุฑูููุฑู.
    

### 4. "ุงูุตุฏุงู" ุจูู ุงููุธุฑูุฉ ูุงููุงูุน (The Dependency Conflict) โ๏ธ

ููุง ุญุฏุซุช ุฃูู ููุทุฉ ูู ุงูููุฏูู:

- **ุงููุธุฑูุฉ:** ุงูู Presentation ูุง ูุฌุจ ุฃู ูุฑู ุงูู Infrastructure.
    
- **ุงููุงูุน:** ููู ูุณุชุทูุน ููู `Program.cs` (ูู ุงูู Presentation) ููุงุฏุงุฉ ุงูุฏุงูุฉ `AddInfrastructure` ูุฑุจุท ุงูุฏุงุชุงุจูุณุ **ูุฌุจ** ุฃู ูุฑู ูุดุฑูุน ุงูู Infrastructure.
    

**ุงูุญู ุงูุฐู ุงุชุฎุฐู ุงููุญุงุถุฑ:**

ูุณุฑ ุงููุงุนุฏุฉ "ููููุงู" ูุนูู `Project Reference` ูู ุงูู API ุฅูู ุงูู Infrastructureุ ูููู ูุน **ุงูุชุฒุงู ุฃุฏุจู**:

> "ูุญู ููุชุญ ุงูุจุงุจ ููุท ูููุงุฏู ุฏุงูุฉ ุงูุชุณุฌููุ ูููููุง ูุนุฏ ุจุฃููุง ูู ูุณุชุฎุฏู ุฃู ููุงุณ ูู ุงูู Infrastructure ุฏุงุฎู ุงูู Controllers."

---

### ููุฎุต ุงูุชุฑุชูุจ ุงูุฌุฏูุฏ ูู `Program.cs`:

ุฃุตุจุญ ุงูููุฏ ุงูุขู ูุธููุงู ุฌุฏุงู:

C#

```
builder.Services
    .AddApplication()
    .AddInfrastructure();
```

---








---

### 1. ููููู ุงูู CQRS (ูุตู ุงููุฑุงุกุฉ ุนู ุงููุชุงุจุฉ)

**CQRS** ูู ุงุฎุชุตุงุฑ ูู **Command Query Responsibility Segregation**.

ุงูููุฑุฉ ุจุณูุทุฉ ุฌุฏุงู: ูุง ุชุฎูุท ุงูุนูููุงุช ุงูุชู "ุชุบูุฑ" ุงูุฏุงุชุงุจูุณ ูุน ุงูุนูููุงุช ุงูุชู "ุชูุฑุฃ" ูููุง.

- **Command (ุฃูุฑ):** ุฃู ุนูููุฉ ุชููู ุจุชุบููุฑ ุญุงูุฉ ุงููุธุงู (Create, Update, Delete). ูุฐู ุงูุนูููุงุช ูุง ุชูุฑุฌุน ุจูุงูุงุช ูุนูุฏุฉ (ุบุงูุจุงู ุชุฑุฌุน `void` ุฃู `Id` ููุท).
    
    - _ูุซุงู:_ `CreateSubscriptionCommand`, `DeleteGymCommand`.
        
- **Query (ุงุณุชุนูุงู):** ุฃู ุนูููุฉ ุชููู ุจุฌูุจ ุจูุงูุงุช ููุท ุฏูู ุชุบููุฑ ุฃู ุดูุก (Read).
    
    - _ูุซุงู:_ `GetSubscriptionQuery`, `ListGymsQuery`.
        

**ููุงุฐุง ูุณุชุฎุฏููุ**

ูู ุงูู Service ุงูุนุงุฏูุฉุ ุชุฌุฏ ุฏุงูุฉ `AddUser` ุจุฌุงูุจ ุฏุงูุฉ `GetUser`. ูุฐุง ุงูุฎูุท ูุฌุนู ุงูููุงุณ ุถุฎูุงู ููุณุคูููุงุชู ุบูุฑ ูุงุถุญุฉ. ุจูุตููุงุ ููููู ุชุญุณูู (Optimize) ุงููุฑุงุกุฉ ุจุดูู ูููุตู ุนู ุงููุชุงุจุฉ (ูุซูุงู ุงุณุชุฎุฏุงู Cache ูููุฑุงุกุฉ ููุท).

---

### 2. ููููู ุงูู Mediator Pattern (ุงููุณูุท)

ููุง ูุฃุชู ูุฃุฏุงุฉ **MediatR** ุงูุชู ุบูุฑุช ุทุฑููุฉ ุชูุงุตู ุงูู Controller ูุน ุงูู Application.

**ุงููุดููุฉ ูุจู MediatR:**

ุงูู Controller ูุงู ูุนุชูุฏ (Depend) ูุจุงุดุฑุฉ ุนูู `ISubscriptionService`. ูุฐุง ูุนูู ูุฌูุฏ "ุงุฑุชุจุงุท" (Coupling).

**ุงูุญู ูุน MediatR:**

ูุถุน "ูุณูุท" (Mediator) ูู ุงูููุชุตู.

1. ุงูู Controller ูุตูุญ: "ูุง ูุณูุทุ ุฎุฐ ูุฐุง ุงูุทูุจ (`CreateSubscriptionCommand`) ูุชุตุฑู!".
    
2. ุงููุณูุท (MediatR) ูุจุญุซ ูู ุณุฌูุงุชู: "ูู ูู ุงููุณุคูู ุนู ุชูููุฐ ูุฐุง ุงูุทูุจุ ุฃูุง! ุฅูู `CreateSubscriptionCommandHandler`".
    
3. ูููู ุงููุณูุท ุจุชุณููู ุงูุทูุจ ููู Handler ูุชุดุบููู.
    

**ุงููุชูุฌุฉ:** ุงูู Controller ูุง ูุนุฑู ุดูุฆุงู ุนู ุงูู Handlerุ ูุงูู Handler ูุง ูุนุฑู ุดูุฆุงู ุนู ุงูู Controller. ููุงููุง ูุนุฑู ุงููุณูุท ููุท.

---

### 3. ุงูุชุทุจูู ุงูุนููู: ููู ุชุญูู ุงูููุฏุ

ุจุฏูุงู ูู `SubscriptionService` ูุงุญุฏุฉ ูุจูุฑุฉุ ุฃุตุจุญ ูุฏููุง 3 ูููุงุช ุตุบูุฑุฉ ููู ุนูููุฉ:

1. **Request (ุงูุทูุจ):**
    
    C#
    
    ```
    // ูุฐุง ูุฌุฑุฏ ููุงุณ ูุญูู ุงูุจูุงูุงุช (ูุซู ุณุงุนู ุงูุจุฑูุฏ)
    public record CreateSubscriptionCommand(string Type, Guid AdminId) : IRequest<Guid>;
    ```
    
2. **Handler (ุงููููุฐ):**
    
    C#
    
    ```
    // ูุฐุง ุงูููุงุณ ูู ุงูุฐู ูุญุชูู ุนูู ุงูููุฌูู ุงููุนูู
    public class CreateSubscriptionCommandHandler : IRequestHandler<CreateSubscriptionCommand, Guid>
    {
        public Task<Guid> Handle(CreateSubscriptionCommand request, CancellationToken token)
        {
            // ููุง ููุชุจ ููุฏ ุฅูุดุงุก ุงูุงุดุชุฑุงู
            return Task.FromResult(Guid.NewGuid());
        }
    }
    ```
    
3. **Controller (ุงููุฑุณู):**
    
    C#
    
    ```
    [HttpPost]
    public async Task<IActionResult> Create(CreateSubscriptionRequest request)
    {
        // 1. ุชุฌููุฒ ุงููููุงูุฏ
        var command = new CreateSubscriptionCommand(request.Type, request.AdminId);
    
        // 2. ุฅุฑุณุงูู ูููุณูุท (ูุงุญุธ ุฃููุง ูุง ููุงุฏู ุงูู Handler ูุจุงุดุฑุฉ)
        var result = await _mediator.Send(command);
    
        return Ok(result);
    }
    ```
    

---

### 4. ุชูุธูู ุงููุฌูุฏุงุช: Feature Folders vs. Layer Folders

ูุฐู ููุทุฉ ุชูุธูููุฉ ูููุฉ ุฌุฏุงู ุฐูุฑูุง ุงููุญุงุถุฑ ูู ููุงูุฉ ุงูููุฏูู.

**ุฃ. ุงูุชูุธูู ุญุณุจ ุงูููุน (By Type) - ุงูุทุฑููุฉ ุงูุชูููุฏูุฉ:**

ุชุถุน ูู ุงูู Services ูู ูููุฏุฑ ุงุณูู `Services`ุ ููู ุงูู Commands ูู ูููุฏุฑ `Commands`.

- _ุงููุดููุฉ:_ ุงูููุฒุงุช ูุจุนุซุฑุฉ. ูุชุนุฏูู ููุฒุฉ "ุงูุงุดุชุฑุงู"ุ ุชูุชุญ 5 ูููุฏุฑุงุช ูุฎุชููุฉ.
    

**ุจ. ุงูุชูุธูู ุญุณุจ ุงูููุฒุฉ (By Feature) - ุทุฑููุฉ Clean Architecture:**

ุชุถุน ูู ูุง ูุฎุต ููุฒุฉ ูุนููุฉ ูู ูููุฏุฑ ูุงุญุฏ.

- **Structure:**
    
    - `Subscriptions/`
        
        - `Commands/`
            
            - `CreateSubscription/` (ูุญุชูู ุนูู ุงูู Command ูุงูู Handler ูุงูู Validator).
                
        - `Queries/`
            
            - `GetSubscription/`
                

**ุงููุงุฆุฏุฉ (Cohesion):** ูู ุงูุฃุดูุงุก ุงููุฑุชุจุทุฉ ุจุจุนุถูุง ุชุนูุด ูุน ุจุนุถูุง. ุฅุฐุง ุฃุฑุฏุช ุญุฐู ููุฒุฉ "ุงูุงุดุชุฑุงู"ุ ุชุญุฐู ุงููููุฏุฑ ุจุงููุงูู ูุงูุชูู ุงูุฃูุฑ.

---

### ููุฎุต ุงูุชุบููุฑุงุช ูู ูุฐุง ุงูุฏุฑุณ:

1. **ุฃูุบููุง** ุงูู `ISubscriptionService` ูุงูู `SubscriptionService`.
    
2. **ุฃุถููุง** ููุชุจุฉ `MediatR` ููุดุฑูุน ุงูู Application.
    
3. **ุฃูุดุฃูุง** `Command` ู `Handler` ูุนูููุฉ ุงูุฅูุดุงุก.
    
4. **ุนุฏูููุง** ุงูู Controller ููุณุชุฎุฏู `_mediator.Send()`.
    
5. **ุณุฌููุง** ุงูู MediatR ูู ุงูู Dependency Injection ููููู ุจุงูุฑุจุท ุฃูุชููุงุชูููุงู.
    

**ูู ุงุชุถุญุช ุงูุตูุฑุฉ ุงูุงูุ** ูุฐุง ุงูููุท (CQRS + Mediator) ูู ุงููุนูุงุฑ ุงูุฐูุจู ุญุงููุงู ูู ุจูุงุก ุงูุฃูุธูุฉ ุงููุงุจูุฉ ููุชูุณุน ูู .NET.



---













---

### ุงูุฎุทูุฉ 1: ุชุซุจูุช ููุชุจุฉ ErrorOr ๐ฆ

ูุฌุจ ุฅุถุงูุฉ ูุฐู ุงูููุชุจุฉ ููุดุฑูุน ุงูู **Application** (ูุฃู ุงููููุงูุฏ ูุงููุงูุฏูุฑ ููุฌูุฏูู ููุงู).

ูู **Package Manager Console** (ุชุฃูุฏ ุฃู ุงูู Default Project ูู `GymManagement.Application`):

PowerShell

```
Install-Package ErrorOr
```

---

### ุงูุฎุทูุฉ 2: ุชุนุฏูู ุงูู Command (ููุน ุงูุฅุฑุฌุงุน)

ุณูุฎุจุฑ ุงูู Mediator ุฃู ูุฐุง ุงูุทูุจ ูู ูุนุฏ ูุฑุฌุน `Guid` ููุทุ ุจู ูุฑุฌุน `ErrorOr<Guid>` (ูุนูู: ุฅูุง Guid ุฃู Error).

ุงูุชุญ ููู `CreateSubscriptionCommand.cs`:

C#

```
using ErrorOr; // namespace ููู
using MediatR;

namespace GymManagement.Application.Subscriptions.Commands.CreateSubscription;

// ุงูุชุบููุฑ ููุง: ุจุฏูุงู ูู <Guid> ุฃุตุจุญุช <ErrorOr<Guid>>
public record CreateSubscriptionCommand(string SubscriptionType, Guid AdminId) : IRequest<ErrorOr<Guid>>;
```

---

### ุงูุฎุทูุฉ 3: ุชุนุฏูู ุงูู Handler (ุงูุชูููุฐ)

ุงูุขู ุงููุงูุฏูุฑ ูุฌุจ ุฃู ููุชุฒู ุจุงูุนูุฏ ุงูุฌุฏูุฏ.

ุงูุชุญ ููู `CreateSubscriptionCommandHandler.cs`:

C#

```
using ErrorOr;
using MediatR;

namespace GymManagement.Application.Subscriptions.Commands.CreateSubscription;

// 1. ุชุญุฏูุซ ุงููุงุฌูุฉ ูุชุชูุงูู ูุน ุงููููุงูุฏ
public class CreateSubscriptionCommandHandler : IRequestHandler<CreateSubscriptionCommand, ErrorOr<Guid>>
{
    public async Task<ErrorOr<Guid>> Handle(CreateSubscriptionCommand request, CancellationToken cancellationToken)
    {
        // ูููุชุฑุถ ุฌุฏูุงู ุฃููุง ูุฑูุฏ ุงูุชุญูู ูู ุดูุก ูุง ูุฅุฑุฌุงุน ุฎุทุฃ (ูุซุงู ุชูุถูุญู)
        // if (someConditionFails) return Error.Validation("Subscription.Invalid", "Some error message");

        // 2. ูู ุญุงูุฉ ุงููุฌุงุญุ ูุฑุฌุน ุงูู Guid
        // ุงูููุชุจุฉ ุฐููุฉ ุฌุฏุงู ูุชููู ุจุชุญููู ุงูู Guid ุฅูู ErrorOr ุชููุงุฆูุงู (Implicit Conversion)
        return Guid.NewGuid();
        
        // ููุงุญุธุฉ: ุฌุนููุง ุงูุฏุงูุฉ async Task ูุถูุงู ุงูุชูุงูู ุงููุณุชูุจูู ุฑุบู ุนุฏู ูุฌูุฏ await ุญุงููุงู
    }
}
```

---

### ุงูุฎุทูุฉ 4: ุชุนุฏูู ุงูู Controller (ุงูุชุนุงูู ูุน ุงููุชูุฌุฉ) ๐ฎ

ูุฐุง ูู ุงูุฌุฒุก "ุงูุฃูุชุน". ุงูู Controller ูู ูุณุชูู `Guid` ูุจุงุดุฑุฉุ ุจู ุณูุณุชูู "ุตูุฏูู ูุบูู" (Result)ุ ูุนููู ุฃู ููุชุญู ูููุฑุฑ ูุงุฐุง ููุนู ุจูุงุกู ุนูู ูุญุชูุงู.

ุงูุชุญ `SubscriptionsController.cs` ูุนุฏู ุฏุงูุฉ ุงูู `CreateSubscription` ูุงูุชุงูู:

C#

```
using ErrorOr; // ูุง ุชูุณู ุงูุฅุถุงูุฉ
using GymManagement.Application.Subscriptions.Commands.CreateSubscription;
using GymManagement.Contracts.Subscriptions;
using MediatR;
using Microsoft.AspNetCore.Mvc;

namespace GymManagement.Api.Controllers;

[ApiController]
[Route("[controller]")]
public class SubscriptionsController : ControllerBase
{
    private readonly ISender _mediator;

    public SubscriptionsController(ISender mediator)
    {
        _mediator = mediator;
    }

    [HttpPost]
    public async Task<IActionResult> CreateSubscription(CreateSubscriptionRequest request)
    {
        var command = new CreateSubscriptionCommand(
            request.SubscriptionType.ToString(),
            request.AdminId
        );

        // 1. ูุณุชูู ุงููุชูุฌุฉ (ุงูุชู ูุฏ ุชููู ูุฌุงุญ ุฃู ูุดู)
        ErrorOr<Guid> createSubscriptionResult = await _mediator.Send(command);

        // 2. ูุณุชุฎุฏู ุฏุงูุฉ MatchFirst ุงูุณุญุฑูุฉ
        // ูุฐู ุงูุฏุงูุฉ ุชููู: "ุฅุฐุง ูุฌุญุชุ ููุฐ ุงูุฏุงูุฉ ุงูุฃููู. ูุฅุฐุง ูุดูุชุ ููุฐ ุงูุฏุงูุฉ ุงูุซุงููุฉ"
        return createSubscriptionResult.MatchFirst(
            
            // ุงููุณุงุฑ ุงูุฃูู: ุงููุฌุงุญ (ูุณุชูู ุงูู guid ููุฑุฌุน Ok)
            guid => Ok(new SubscriptionResponse(guid, request.SubscriptionType)),

            // ุงููุณุงุฑ ุงูุซุงูู: ุงููุดู (ูุณุชูู ุงูู error ููุฑุฌุน Problem)
            error => Problem()
        );
    }
}
```

---

### ุดุฑุญ ุฏุงูุฉ `.MatchFirst` ุจุจุณุงุทุฉ:

ูู ุชุดุจู ุฌููุฉ `if/else` ููู ุจุทุฑููุฉ ุฃูููุฉ (Functional Programming).

- ุงููุนุงูู ุงูุฃูู `guid => ...`: ูุชู ุชูููุฐู ููุท ุฅุฐุง ูุงู ุงูู Result ูุญุชูู ุนูู ูููุฉ (Value).
    
- ุงููุนุงูู ุงูุซุงูู `error => ...`: ูุชู ุชูููุฐู ููุท ุฅุฐุง ูุงู ุงูู Result ูุญุชูู ุนูู ุฎุทุฃ (Error).
    

ุจูุฐู ุงูุทุฑููุฉุ ุงูู Controller ุฃุตุจุญ ูุธููุงู ุฌุฏุงูุ ููุง ููุฌุฏ ุฃู `try-catch`ุ ููุณุชุทูุน ุงูุชุนุงูู ูุน ุฃู ุฎุทุฃ ูุฃุชู ูู ุงูู Domain ุฃู Application ูุชุญูููู ูู `Problem Details` (ููุฏ 500 ุฃู 400) ุชููุงุฆูุงู.

**ุฌุฑุจ ุชุทุจูู ูุฐู ุงูุชุบููุฑุงุชุ ููุงุญุธ ููู ุณูุตุจุญ ุงูููุฏ ุฃูุซุฑ ุฃูุงูุงู!** ูู ูุงุฌูุช ุฃู ุตุนูุจุฉ ูู ููู ุงูู Lambda Expressions ุฏุงุฎู ุงูู Matchุ



---









### 1. ููููู ุงูู Repository Pattern ๐ฆ

ุงูู Repository ูู ุนุจุงุฑุฉ ุนู "ููู" (Illusion). ูู ูุฌุนููุง ูุชุนุงูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฃููุง ูุฌุฑุฏ `List` ููุฌูุฏุฉ ูู ุงูููููุฑู (Add, Remove, Get).

- **ุงููุงุฆุฏุฉ:** ููุตู ุงูู Application ุนู ุชูุงุตูู ุงูุฏุงุชุงุจูุณ (ุณูุงุก ูุงูุช SQL Server ุฃู MongoDB).
    

### 2. ุงูุชุบููุฑุงุช ูู ุทุจูุฉ ุงูู Domain ๐ฐ

ูุฃูู ูุฑุฉุ ูููุณ ุทุจูุฉ ุงูู Domain. ูุงู ุงููุญุงุถุฑ ุจุฅูุดุงุก ููุงุณ `Subscription` ุจุณูุท ุฌุฏุงู (Placeholder) ูููุซู ุงูุงุดุชุฑุงู.

- **ุงููุณุงุฑ:** `GymManagement.Domain/Subscriptions/Subscription.cs`
    
- **ุงููุญุชูู:** ุญุงููุงู ูุญุชูู ููุท ุนูู `Id` ูู ููุน `Guid`.
    

### 3. ุงูุชุบููุฑุงุช ูู ุทุจูุฉ ุงูู Application โ๏ธ

ุฃุถุงู ุงููุญุงุถุฑ ูุงุฌูุฉ (Interface) ููุฑูุจูุณุชูุฑูุ ูุนุฏู ุงูู Handler ููุณุชุฎุฏููุง.

- **ุฅูุดุงุก ุงููุงุฌูุฉ:**
    
    - **ุงููุณุงุฑ:** `GymManagement.Application/Common/Interfaces/ISubscriptionsRepository.cs`
        
    - **ุงูููุฏ:** ุชุญุชูู ุนูู `AddSubscription(Subscription subscription)`.
        
- **ุชุนุฏูู ุงูู Handler:**
    
    - ุชู ุญูู `ISubscriptionsRepository` ูู ุงูู Constructor.
        
    - ุงูู Handler ุงูุขู ูููู ุจู:
        
        1. ุฅูุดุงุก ูุงุฆู `Subscription` (Domain Object).
            
        2. ููุงุฏุงุฉ `repository.AddSubscription(subscription)` ูุญูุธู.
            
        3. ุฅุฑุฌุงุน ุงููุงุฆู ูุงููุงู (ุจุฏูุงู ูู ุงูู Guid ููุท ููุง ูุงู ุณุงุจูุงู).
            

### 4. ุงูุชุบููุฑุงุช ูู ุทุจูุฉ ุงูู API ๐ฎ

ุชุนุฏูู ุจุณูุท ูู ุงูู Controller ููุชูุงูู ูุน ุงูุชุบููุฑ ูู ุงูู Handler (ูุฃูู ุฃุตุจุญ ูุฑุฌุน `Subscription` ูุงููุฉ).

- ูู ุฏุงูุฉ `MatchFirst`ุ ุฃุตุจุญ ูุฃุฎุฐ `subscription.Id` ุจุฏูุงู ูู `guid`.
    

---

### ููุทุฉ ูุงูุฉ ุฌุฏุงู (The Missing Piece) ๐งฉ

ุงููุญุงุถุฑ ูุจู ุฃู ุงูููุฏ **ูู ูุนูู ุงูุขู**.

- **ุงูุณุจุจ:** ูุญู ุนุฑูููุง ุงูู Interface (`ISubscriptionsRepository`) ูุงุณุชุฎุฏููุงูุงุ ููููุง **ูู ููู ุจุฅูุดุงุก ุงูููุงุณ ุงูุฐู ูููุฐูุง (Implementation)** ููู ูุณุฌูู ูู ุงูู DI.
    
- ูุฐุง ุงูุชูููุฐ ุณูุชู ูู ุทุจูุฉ ุงูู **Infrastructure** ูุงุญูุงู.
    

---








---

### 1. ุทุจูุฉ ุงูู Application (ุฅุถุงูุฉ ูุงุฌูุฉ IUnitOfWork)

ุฃูุดุฆ ูููุงู ุฌุฏูุฏุงู ูู: `GymManagement.Application/Common/Interfaces/IUnitOfWork.cs`

C#

```
namespace GymManagement.Application.Common.Interfaces;

public interface IUnitOfWork
{
    Task CommitChangesAsync();
}
```

---

### 2. ุทุจูุฉ ุงูู Application (ุชุญุฏูุซ ูุงุฌูุฉ ุงูู Repository)

ุทูุจ ุงููุญุงุถุฑ ุชุญููู ุงูุฏุงูุฉ ูุชููู `Async` (ูุฃู ุงูุชุนุงูู ูุน ุงูุฏุงุชุงุจูุณ ุฏุงุฆูุงู ุบูุฑ ูุชุฒุงูู).

ุชุนุฏูู ุงูููู: `GymManagement.Application/Common/Interfaces/ISubscriptionsRepository.cs`

C#

```
using GymManagement.Domain.Subscriptions;

namespace GymManagement.Application.Common.Interfaces;

public interface ISubscriptionsRepository
{
    // ุชุบููุฑ ุงูุงุณู ูู Async ูุชุบููุฑ ุงูููุน ูู Task
    Task AddSubscriptionAsync(Subscription subscription);
}
```

---

### 3. ุทุจูุฉ ุงูู Application (ุชุญุฏูุซ ุงูู Handler)

ุณูููู ุงูุขู ุจุญูู ุงูู `IUnitOfWork` ูุงุณุชุฎุฏุงูู ูุญูุธ ุงูุชุบููุฑุงุช ูู ุงูููุงูุฉ.

ุชุนุฏูู ุงูููู: `GymManagement.Application/Subscriptions/Commands/CreateSubscription/CreateSubscriptionCommandHandler.cs`

C#

```
using ErrorOr;
using GymManagement.Application.Common.Interfaces;
using GymManagement.Domain.Subscriptions;
using MediatR;

namespace GymManagement.Application.Subscriptions.Commands.CreateSubscription;

public class CreateSubscriptionCommandHandler : IRequestHandler<CreateSubscriptionCommand, ErrorOr<Subscription>>
{
    private readonly ISubscriptionsRepository _subscriptionsRepository;
    private readonly IUnitOfWork _unitOfWork; // 1. ุชุนุฑูู ุงููุชุบูุฑ

    // 2. ุญูู ุงูู UnitOfWork ูู ุงูู Constructor
    public CreateSubscriptionCommandHandler(
        ISubscriptionsRepository subscriptionsRepository, 
        IUnitOfWork unitOfWork)
    {
        _subscriptionsRepository = subscriptionsRepository;
        _unitOfWork = unitOfWork;
    }

    public async Task<ErrorOr<Subscription>> Handle(CreateSubscriptionCommand request, CancellationToken cancellationToken)
    {
        var subscription = new Subscription
        {
            Id = Guid.NewGuid()
        };

        // 3. ุฅุถุงูุฉ ุงูุงุดุชุฑุงู (ูุงุญุธ ุงุณุชุฎุฏุงู await ูุฃู
```



---







### 1. ุงููุดููุฉ: ุณููุงุฑูู "ูุตู ุงูุนูููุฉ ุงููุงุฌุญุฉ" 

ุชุฎูู ุงูุณููุงุฑูู ุงูุชุงูู ุงูุฐู ุฐูุฑู ุงููุญุงุถุฑ (ูุณุชูุจูุงู):

ูุฑูุฏ ุฅูุดุงุก "ุฌูู" (Gym) ูุฑุจุทู ุจุงุดุชุฑุงู (Subscription). ุงูุนูููุฉ ุชุชุทูุจ ุฎุทูุชูู ูู ุงูุฏุงุชุงุจูุณ:

1. ุชุนุฏูู ุฌุฏูู ุงูุงุดุชุฑุงูุงุช (`Subscriptions Table`).
    
2. ุฅุถุงูุฉ ุณุทุฑ ุฌุฏูุฏ ูู ุฌุฏูู ุงูุฌูู (`Gyms Table`).
    

**ูุงุฐุง ูู ุญุฏุซุช ูุงุฑุซุฉุ**

- ุงูุจุฑูุงูุฌ ููุฐ ุงูุฎุทูุฉ ุงูุฃููู ุจูุฌุงุญ (ุนุฏูู ุงูุงุดุชุฑุงู).
    
- ูุฌุฃุฉ ุงููุทุน ุงูุงุชุตุงูุ ุฃู ุถุฑุจ ุงูุณูุฑูุฑุ ุฃู ุญุฏุซ Exception ูุจู ุชูููุฐ ุงูุฎุทูุฉ ุงูุซุงููุฉ.
    

**ุงููุชูุฌุฉ:**

ุนูุฏู ุงุดุชุฑุงู "ูุนุชูุฏ" ุฃูู ูุฑุจูุท ุจุฌููุ ููู ุงูุฌูู ุบูุฑ ููุฌูุฏ ูุนููุงู! ูุฐู ุจูุงูุงุช ูุงุณุฏุฉ (Corrupted Data).

### 2. ุงูุญู: ููุท Unit of Work (ุฒุฑ ุงูุญูุธ ุงููุงุญุฏ)

ุงูู **Unit of Work** ูุญู ูุฐู ุงููุดููุฉ ุจููููู **Transaction (ุงููุนุงููุฉ ุงูุฐุฑูุฉ)**.

ุจุฏูุงู ูู ุฃู ูุญูุธ ูู ุฎุทูุฉ ููุฑุงูุ ูุญู ูููู ุจู:

1. ููุชุญ "ูุนุงููุฉ" (Transaction).
    
2. ูููู ุจูู ุงูุชุนุฏููุงุช ูู ุงูููููุฑู (ูุถูู ุฌููุ ูุนุฏู ุงุดุชุฑุงูุ ูุญุฐู ูุณุชุฎุฏู...).
    
3. ูู ุงูููุงูุฉุ ููุงุฏู `CommitChangesAsync`.
    

**ุงููุงุนุฏุฉ:** ุฅูุง ุฃู ุชูุฌุญ **ูู** ุงูุนูููุงุช ูุชุญูุธ ูู ุงูุฏุงุชุงุจูุณ ุฏูุนุฉ ูุงุญุฏุฉุ ุฃู ุฅุฐุง ูุดูุช ูุงุญุฏุฉุ ูุชู ุงูุชุฑุงุฌุน ุนู **ุงููู** (Rollback) ููุฃู ุดูุฆุงู ูู ูุญุฏุซ.

---

### ุงูุชุทุจูู ุงูุนููู: ุงูููุฏ ุจุงูุชูุตูู ๐๏ธ

ุณูููู ุจุซูุงุซุฉ ุชุบููุฑุงุช ุฑุฆูุณูุฉ ูู ุทุจูุฉ ุงูู **Application**:

#### ุฃููุงู: ุฅูุดุงุก ูุงุฌูุฉ "ูุญุฏุฉ ุงูุนูู"

ุณูุนุฑู ูุงุฌูุฉ ุชุญุชูู ุนูู ุฒุฑ "ุงูุญูุธ" ููุท.

- **ุงููุณุงุฑ:** `GymManagement.Application/Common/Interfaces/IUnitOfWork.cs`
    
- **ุงูููุฏ:**
    

C#

```
namespace GymManagement.Application.Common.Interfaces;

public interface IUnitOfWork
{
    // ูุฐู ุงูุฏุงูุฉ ูู ุงููุณุคููุฉ ุนู ุญูุธ ูู ุงูุชุบููุฑุงุช ุงููุนููุฉ ุฏูุนุฉ ูุงุญุฏุฉ
    Task CommitChangesAsync();
}
```

#### ุซุงููุงู: ุชุญุฏูุซ ุงูู Repository ููููู Async โก

ุจูุง ุฃููุง ุณูุจุฏุฃ ุงูุชุนุงูู ุจุฌุฏูุฉุ ุนูููุงุช ุงูุฏุงุชุงุจูุณ ุฏุงุฆูุงู ุชุฃุฎุฐ ููุชุงู (I/O Bound)ุ ูุฐุง ูุฌุจ ุชุญููููุง ูู Asynchronous ูุนุฏู ุชุฌููุฏ ุงูุณูุฑูุฑ.

- **ุงููุณุงุฑ:** `GymManagement.Application/Common/Interfaces/ISubscriptionsRepository.cs`
    
- **ุงูููุฏ (ุงูุชุนุฏูู):**
    

C#

```
using GymManagement.Domain.Subscriptions;

namespace GymManagement.Application.Common.Interfaces;

public interface ISubscriptionsRepository
{
    // 1. ุญูููุงูุง ูู Task (ุนุดุงู ุงูู await)
    // 2. ุบูุฑูุง ุงูุงุณู ูู AddSubscriptionAsync (ุชุณููุฉ ููุงุณูุฉ)
    Task AddSubscriptionAsync(Subscription subscription);
}
```

#### ุซุงูุซุงู: ุฑุจุท ูู ุดูุก ูู ุงูู Handler ๐ง

ููุง ุณูููู ููู Handler: "ุงุณุชุฎุฏู ุงูุฑูุจูุณุชูุฑู ููุฅุถุงูุฉุ ููู ูุง ุชุนุชุจุฑ ุงูุนูููุฉ ุงูุชูุช ุฅูุง ููุง ููุงุฏู ุงูู Unit of Work".

- **ุงููุณุงุฑ:** `GymManagement.Application/Subscriptions/Commands/CreateSubscription/CreateSubscriptionCommandHandler.cs`
    
- **ุงูููุฏ:**
    

C#

```
using ErrorOr;
using GymManagement.Application.Common.Interfaces;
using GymManagement.Domain.Subscriptions;
using MediatR;

namespace GymManagement.Application.Subscriptions.Commands.CreateSubscription;

public class CreateSubscriptionCommandHandler : IRequestHandler<CreateSubscriptionCommand, ErrorOr<Subscription>>
{
    private readonly ISubscriptionsRepository _subscriptionsRepository;
    private readonly IUnitOfWork _unitOfWork; // 1. ูุชุบูุฑ ุฌุฏูุฏ

    // 2. ูุญูู ุงูู UnitOfWork ูู ุงููููุณุชุฑูุชูุฑ
    public CreateSubscriptionCommandHandler(
        ISubscriptionsRepository subscriptionsRepository, 
        IUnitOfWork unitOfWork)
    {
        _subscriptionsRepository = subscriptionsRepository;
        _unitOfWork = unitOfWork;
    }

    public async Task<ErrorOr<Subscription>> Handle(CreateSubscriptionCommand request, CancellationToken cancellationToken)
    {
        // ุฅูุดุงุก ุงููุงุฆู (Domain logic placeholder)
        var subscription = new Subscription { Id = Guid.NewGuid() };

        // 3. ุฅุถุงูุฉ ููููููุฑู (ูุงุญุธ ุงุณุชุฎุฏุงู await ูุชุบููุฑ ุงุณู ุงูุฏุงูุฉ)
        await _subscriptionsRepository.AddSubscriptionAsync(subscription);

        // 4. ุงููุญุธุฉ ุงูุญุงุณูุฉ: ุญูุธ ุงูุชุบููุฑุงุช ูุนููุงู ูู ุงูุฏุงุชุงุจูุณ
        // ูู ุญุฏุซ ุฎุทุฃ ูุจู ูุฐุง ุงูุณุทุฑุ ูู ูุชู ุญูุธ ุฃู ุดูุก
        await _unitOfWork.CommitChangesAsync();

        return subscription;
    }
}
```

---

### ููุงุฐุง ูุญุชุงุฌ `IUnitOfWork` ุฅุฐุง ูุงู ุนูุฏูุง `Repository`ุ ๐ค

ุณุคุงู ูุฏ ูุฎุทุฑ ุจุจุงูู: "ููุงุฐุง ูุง ูุถุน `SaveChanges` ุฏุงุฎู `AddSubscriptionAsync` ูุฎูุตูุงุ"

ุงูุฌูุงุจ ูู **ุงูุณููุงุฑูููุงุช ุงููุนูุฏุฉ**:

ูู ูุถุนุช ุงูุญูุธ ุฏุงุฎู ุงูุฑูุจูุณุชูุฑูุ ุจูุฌุฑุฏ ูุง ุชูุงุฏู `AddSubscription` ุณูุชู ุงูุญูุธ.

ุทูุจ ูู ุงูููุฏ ุชุจุนู ูุงู ูุงูุชุงูู:

C#

```
_repo.AddSubscription(sub); // ุญูุธ ููุฑุงู!
_repo.AddGym(gym);          // ูุดู ููุง!
```

ุงููุชูุฌุฉ: ุตุงุฑ ุนูุฏู ุงุดุชุฑุงู ุจุฏูู ุฌูู ูู ุงูุฏุงุชุงุจูุณ.

ุจูููุง ูุน **Unit of Work**:

C#

```
_repo.AddSubscription(sub); // ุชู ุงูุชุฌููุฒ ููุท
_repo.AddGym(gym);          // ุชู ุงูุชุฌููุฒ
_unitOfWork.Commit();       // ุญูุธ ุงูุงุซููู ูุนุงู ุงูุขู
```

---

**ููุงุญุธุฉ ุฎุชุงููุฉ ูููุฉ:**

ุญุชู ุงูุขูุ ุงูููุฏ ููู "ูุงุฌูุงุช" (Interfaces) ูู ุทุจูุฉ ุงูู **Application**.

ุงูู **Application** ูููู: "ุฃูุง ุฃุฑูุฏ ุฃุญูุธ"ุ ูููู ูุง ูุนุฑู "ููู".

ูู ุงูููุฏูู ุงููุงุฏู (Infrastructure Layer)ุ ุณูููู ุจูุชุงุจุฉ ุงูููุฏ ุงููุนูู ุงูุฐู ูููุฐ `CommitChangesAsync` ุจุงุณุชุฎุฏุงู **Entity Framework Core** ู **DbContext**.




---










---

### 1. ุงูููุณูุฉ: ุงูุญูู vs ุงููุงูุน (Application vs Infrastructure)

- **ูู ุงูู Application Layer (ุงูุญูู):**
    
    ูุญู ูุชุจูุง `ISubscriptionsRepository`. ูุฐุง ูุฌุฑุฏ "ุนูุฏ" ุฃู "ุญูู". ูุญู ูููู: _"ูุง ููุช ุนูุฏู ุทุฑููุฉ ุฃุญูุธ ูููุง ุงูุงุดุชุฑุงู"_ุ ููููุง ูุง ูุนุฑู ููู.
    
- **ูู ุงูู Infrastructure Layer (ุงููุงูุน):**
    
    ููุง ูุฃุชู ุงููุจุฑูุฌ ููููู: _"ุชูุงูุ ุฃูุง ุณุฃุญูู ุญููู. ุณุฃูุชุจ ููุฏ ูุญูุธ ุงูุงุดุชุฑุงู ูุนููุงู"_.
    

**ููุงุฐุง ูุฐุง ุงููุตูุ**

- **ููุด ุขู:** ุนุดุงู ูู ูุฑุฑุช ุจูุฑุฉ ุชุบูุฑ ุทุฑููุฉ ุงูุญูุธ ูู "ููููุฑู" ูู "SQL" ูู "ููู Text"ุ ุงูู Application ูุง ูุชุบูุฑ ููู ููุง ุณุทุฑ ููุฏ. ูู ูุณุงุชู ุจูููู ููุณ ุงูู Interface.
    
- **ููุด ูุง:** ูู ูุชุจูุง ููุฏ ุงูุฏุงุชุงุจูุณ ุฌูุง ุงูู Applicationุ ุตุฑูุง "ูุฑุจูุทูู" (Coupled) ุจุงูุฏุงุชุงุจูุณุ ููุณุชุญูู ูุบูุฑูุง ุจุณูููุฉ.
    

---

### 2. ุงูุชูููุฐ ุงููุคูุช (In-Memory Database) ๐ง

ุงููุญุงุถุฑ ูุงู ุจุฅูุดุงุก ููุงุณ `SubscriptionsRepository` ูููุฐ ุงููุงุฌูุฉุ ูููู ุงุณุชุฎุฏู `List` ุนุงุฏูุฉ ุจุฏูุงู ูู ุงูุฏุงุชุงุจูุณ.

#### ููุด ุงุณุชุฎุฏู `List`ุ ููุด ูุง ุดุจู ุฏุงุชุงุจูุณ ููุฑุงูุ

- **ุงูุณุจุจ:** ุนุดุงู ูุฎุชุจุฑ **"ุงูุฃุฑููุชูุดุฑ"** (ุชุฏูู ุงูุจูุงูุงุช) ูุจู ูุง ูุบุฑู ูู ุชูุงุตูู **"ุงูููููุฌุฑูุดู"** (SQL Connection Strings, Migrations, etc).
    
- ูู ูุฑูุฏ ุงูุชุฃูุฏ ุฃู ุงูู Controller ุจูููู ุงูู Mediatorุ ูุงูู Mediator ุจูููู ุงูู Handlerุ ูุงูู Handler ุจูููู ุงูู Repository. ุฅุฐุง ุงุดุชุบูุช ูุฐู ุงูุณูุณูุฉ ุจู Listุ ุณุชุนูู ุจู SQL ูุงุญูุงู.
    

#### ููุด ุฎูู ุงูููุณุช `static`ุ (ููุทุฉ ุฌููุฑูุฉ ุฌุฏุงู) โ๏ธ

C#

```
private static readonly List<Subscription> _subscriptions = new();
```

- **ููุด ุขู:** ูุฃู ุงูู Repository ูุณุฌู ูู **Scoped**. ูุนูู ูุน ูู Request ุฌุฏูุฏุ ุงูุณูุฑูุฑ ุจูุนูู `new Repository()`.
    
    - ูู ูุงูุช ุงูู List ุนุงุฏูุฉ (ูุด static): ูุน ูู Request ุฌุฏูุฏ ุฑุญ ุชูุนูู List ุฌุฏูุฏุฉ ูุงุถูุฉุ ูุงูุจูุงูุงุช ุงููุฏููุฉ ุฑุญ ุชุทูุฑ!
        
    - ููุง ุชููู **Static**: ุงูู List ูุดุชุฑูุฉ ุจูู ูู ุงูู Requests ูุชุถู ุนุงูุดุฉ ุทูู ูุง ุงูุณูุฑูุฑ ุดุบุงู.
        
- **ููุด ูุง:** ูู ุงููุถุน ุงูุทุจูุนู (ูุน ุงูุฏุงุชุงุจูุณ ุงูุญููููุฉ) ูุง ุจูุณุชุฎุฏู staticุ ูุฃู ุงูุฏุงุชุงุจูุณ ูู ุงููู ุจุชุญูุธ ุงูุจูุงูุงุช ุจุดูู ุฏุงุฆู.
    

---

### 3. ุชูุธูู ุงููููุงุช (Persistence Folder) ๐

ูุงู ุจุฅูุดุงุก ูููุฏุฑ `Persistence` ุฏุงุฎู `Subscriptions`.

- **ููุด ููู:** ูุฐุง ูุชุจุน ูุจุฏุฃ **Vertical Slices** (ุงูุชูุณูู ุญุณุจ ุงูููุฒุฉ). ูู ูุง ูุฎุต "ุงูุงุดุชุฑุงูุงุช" (Commands, Queries, Repository Implementation) ููุฌูุฏ ุชุญุช ูุธูุฉ ูุงุญุฏุฉ ุฃู ุชูุณูู ูุงุถุญุ ุจุฏูุงู ูู ูุถุน ูู ุงูู Repositories ูู ูููุฏุฑ ูุงุญุฏ ุถุฎู.
    

---

### 4. ุฑุจุท ุงูุฃุณูุงู (Dependency Injection) ๐

ูู ููู `DependencyInjection.cs` ุงูุชุงุจุน ููู Infrastructure:

C#

```
services.AddScoped<ISubscriptionsRepository, SubscriptionsRepository>();
```

**ุดุฑุญ ุงูุณุทุฑ ูุฐุง "ุจุงููุนููุฉ":**

ุฃูุช ุจุชููู ููุจุฑูุงูุฌ: _"ูุง ูุธุงูุ ููุง ุงูู Application Layer ูุทูุจ ููู `ISubscriptionsRepository` (ุงูุนูุฏ)ุ ุฑูุญ ุงุฎูู ูู ูุณุฎุฉ ูู `SubscriptionsRepository` (ุงูุชูููุฐ ุงูููุฌูุฏ ูู Infrastructure) ูุฃุนุทู ุฅูุงูุง"_.

- **ููุด ุขู:** ูุฐุง ูู **Dependency Inversion**. ุงูู Application ูุทูุจ Interfaceุ ูุงูู Infrastructure ูููุฑ Implementation.
    
- **ููุด ูุง:** ูู ุงูู Controller ุนูู `new SubscriptionsRepository()` ุจููุณูุ ูุณุฑูุง ูู ูุจุฏุฃ ุงููููู ุฃุฑููุชูุดุฑ ูุตุงุฑ ุงูู Controller ูุนุชูุฏ ุนูู ุงูู Infrastructure ูุจุงุดุฑุฉ.
    

---

### 5. ููุด ุนูู Comment Out ููู Unit of Workุ ๐

ุงููุญุงุถุฑ ูู ุงูู Handler ูุงู ุจุชุนุทูู ุณุทุฑ:

`// await _unitOfWork.CommitChangesAsync();`

**ููุดุ**

- ูุฃููุง ุญุงููุงู ูุณุชุฎุฏู `List`. ุจูุฌุฑุฏ ูุง ุชุนูู `_list.Add(item)`ุ ุงูุนูุตุฑ ุงูุถุงู ููุฑุงู ูุงูุชูู ุงูููุถูุน. ุงูู List ูุง ูููุง ููููู Transaction (ุงูุชุญุ ุถููุ ุงุญูุธ).
    
- ุงูู Unit of Work ูุตููุฉ ููุฏุงุชุงุจูุณ ุงูุญููููุฉ (Entity Framework) ุงููู ุจุชุณุชูู ุฃูุฑ `SaveChanges`.
    
- ูุฐููุ ุนุดุงู ุงูููุฏ ูุดุชุบู ุงูุขู ุจุฏูู ุฃุฎุทุงุกุ ุนุทู ุงูุณุทุฑ ูุคูุชุงู ูุญุฏ ูุง ูุฑูุจ ุงูุฏุงุชุงุจูุณ ุงูุญููููุฉ.
    

---

### 6. ุฅุถุงูุฉ "Get Subscription" (Query) ๐

ุฃุถุงู ููุฒุฉ ุฌุฏูุฏุฉ ูุงููุฉ (Query + Handler + Endpoint) ูุฌูุจ ุงูุงุดุชุฑุงู.

**ููุด ุณูุงูุง ุงูุขูุ**

- ุนุดุงู ูุซุจุช ูู ุฅู "ุงูุฏูุฑุฉ ูุงููุฉ" ุดุบุงูุฉ.
    
- ุฃูุช ุนููุช `Create` -> ุงูุจูุงูุงุช ุฑุงุญุช ููู List (ูู ุงูู Infrastructure).
    
- ุฃูุช ุนููุช `Get` -> ุงูุจูุงูุงุช ุฑุฌุนุช ูู ุงูู List (ูู ุงูู Infrastructure).
    
- ูุฐุง ุงูุฏููู ุงููุงุทุน ุฅู ุงูุทุจูุงุช ูุฑุจูุทุฉ ุตุญุ ูุงูุจูุงูุงุช ูุฎุฒูุฉ (ููู ูุคูุชุงู ูู ุงูููููุฑู).
    

### ุงูุฎูุงุตุฉ (ุงูุฒุจุฏุฉ):

ูุง ูุนูู ุงููุญุงุถุฑ ูู ุจูุงุก **"ุงููููู ุงูุนุธูู"** ูููุธุงู.

1. ุงูู **Application** ุญุท ุงูููุงููู (Interfaces).
    
2. ุงูู **Infrastructure** ููุฐ ุงูููุงููู (ุจุฃุจุณุท ุทุฑููุฉ ููููุฉ: List).
    
3. ุงูู **Dependency Injection** ุฑุจุท ุงูุงุซููู ุจุจุนุถ.
    

ุงูุขู ุงููุธุงู "ุญู" ูุดุบุงูุ ูุงูุฎุทูุฉ ุงููุงุฏูุฉ ูู ููุท ุงุณุชุจุฏุงู ุงูู `List` ุจู `SQL Database`ุ ููู ูุถุทุฑ ูุชุบููุฑ ุฃู ุดูุก ูู ุงูู Application Layer. **ููุง ุชููู ุนุธูุฉ ุงููููู ุฃุฑููุชูุดุฑ.**



---








---

### ุงูุฌุฒุก ุงูุฃูู: ุงูุงูุชูุงู ุฅูู Entity Framework Core (ุงูุชุทุจูู ุงูุนููู) ๐๏ธ

ุงููุฏู: ุงุณุชุจุฏุงู ุงูู `List` ุงูุซุงุจุชุฉ ุจู ูุงุนุฏุฉ ุจูุงูุงุช ุญููููุฉ (SQLite) ุจุงุณุชุฎุฏุงู EF Core.

#### 1. ุชุซุจูุช ุงูุญุฒู (NuGet Packages) ๐ฆ

ูู ูุดุฑูุน ุงูู **Infrastructure**ุ ูุญุชุงุฌ ููุฐู ุงูููุชุจุงุช:

- `Microsoft.EntityFrameworkCore`: ุงูุฃุณุงุณ.
    
- `Microsoft.EntityFrameworkCore.Sqlite`: ูุฃููุง ุณูุณุชุฎุฏู SQLite.
    
- `Microsoft.EntityFrameworkCore.Design`: ุนุดุงู ูุนูู Migrations (ุชุถุงู ููุดุฑูุน API ุฃูุถุงู).
    

#### 2. ุฅูุดุงุก ุงูู DbContext ๐๏ธ

ุงูู DbContext ูู "ููุฒุฉ ุงููุตู" ุจูู ููุฏู ููุงุนุฏุฉ ุงูุจูุงูุงุช.

- **ุงูููุงู:** `Infrastructure/Common/Persistence/GymManagementDbContext.cs`
    
- **ุงูููุฏ:**
    

C#

```
public class GymManagementDbContext : DbContext, IUnitOfWork // ูุงุญุธ ุชุทุจูู IUnitOfWork
{
    public GymManagementDbContext(DbContextOptions options) : base(options) { }

    public DbSet<Subscription> Subscriptions { get; set; } = null!;

    // ุชูููุฐ IUnitOfWork ููุง ุจุจุณุงุทุฉ ุดุฏูุฏุฉ
    public async Task CommitChangesAsync()
    {
        await base.SaveChangesAsync();
    }
}
```

#### 3. ุชุนุฏูู ุงูู Repository ูุงุณุชุฎุฏุงู DbContext ๐

ุจุฏูุงู ูู `_list.Add`ุ ุณูุณุชุฎุฏู `_dbContext.Subscriptions.Add`.

- **ุงูููุงู:** `Infrastructure/Subscriptions/Persistence/SubscriptionsRepository.cs`
    
- **ุงูููุฏ:**
    

C#

```
public class SubscriptionsRepository : ISubscriptionsRepository
{
    private readonly GymManagementDbContext _dbContext;

    public SubscriptionsRepository(GymManagementDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    public async Task AddSubscriptionAsync(Subscription subscription)
    {
        // ุฅุถุงูุฉ ููููููุฑู ุงูุฎุงุตุฉ ุจู EF Core (Tracking)
        await _dbContext.Subscriptions.AddAsync(subscription);
        
        // ูุงุญุธ: ูุง ููุฌุฏ SaveChanges ููุง!
    }

    public async Task<Subscription?> GetByIdAsync(Guid id)
    {
        return await _dbContext.Subscriptions.FindAsync(id);
    }
}
```

#### 4. ุฅุนุฏุงุฏ ุงูู Dependency Injection (DI) ๐

ูู `Infrastructure/DependencyInjection.cs`:

C#

```
services.AddDbContext<GymManagementDbContext>(options => 
    options.UseSqlite("Data Source=GymManagement.db"));

// ุชุณุฌูู IUnitOfWork ููู ูุณุชุฎุฏู ููุณ ุงูู DbContext
services.AddScoped<IUnitOfWork>(provider => 
    provider.GetRequiredService<GymManagementDbContext>());
```

---

### ุงูุฌุฒุก ุงูุซุงูู: ุงูููุงุด ุงูููุณูู "ุงููุซูุฑ ููุฌุฏู" ๐ฅ

**(ูู ุงูู Repository & Unit of Work ุฒูุงุฏุฉ ููุณูุฉ ูุน EF Coreุ)**

ูุฐุง ูู ุงูููุถูุน ุงูุฐู ุทูุจุช ุงูุชุฑููุฒ ุนูููุ ููู ููุงุด ูุฏูุฑ ูู ูู ุดุฑูุฉ ุจุฑูุฌูุงุช.

#### ูุฌูุฉ ุงููุธุฑ ุงููุนุงุฑุถุฉ (ุถุฏ ุงุณุชุฎุฏุงู ุงูุจุงุชุฑูุฒ):

ูููููู: _"ูุง ุฌูุงุนุฉุ ุงูู Entity Framework ุฃุตูุงู ูุตููุฉ ุนูู ุฃููุง Repository ู Unit of Work!"_

- **ุงูู `DbSet` ูู Repository:** ููู `Add`, `Remove`, `Find`.
    
- **ุงูู `DbContext` ูู Unit of Work:** ููู `SaveChanges` (ุงููู ุจุชุนูู Commit).
    
- **ุงูุญุฌุฉ:** ููุด ุฃุนูู `MyRepository` ูุบูู `DbSet`ุ ูุฃุนูู `MyUnitOfWork` ูุบูู `DbContext`ุ ูุฐุง ุชูุฑุงุฑ ููููุฏ (Wrapper over Wrapper)!
    

#### ูุฌูุฉ ุงููุธุฑ ุงููุคูุฏุฉ (ูุน ุงุณุชุฎุฏุงู ุงูุจุงุชุฑูุฒ - ุฑุฃู ุงููุญุงุถุฑ ูุงููููู ุฃุฑููุชูุดุฑ):

ุงูุฑุฏ ุนูููู ูููู ุจู 3 ููุงุท ูููุฉ:

1. **ุงูุฅุฎูุงุก (Abstraction):**
    
    ุงูู EF Core ูู "Leaky Abstraction". ูุนูู ูู ุงุณุชุฎุฏูุช `DbContext` ูุจุงุดุฑุฉ ูู ุงูู Application Layerุ ูุฃูุช ุฑุจุทุช ููุฏู ุจููุชุจุฉ EF Core.
    
    - ูู ูุฑุฑุช ุจูุฑุฉ ุชุณุชุฎุฏู Dapper ุฃู MongoDBุ ุฑุญ ุชุถุทุฑ ุชุบูุฑ ูู ุงูู Handlers.
        
    - ูุน ุงูู Repository ุงูุฎุงุต ุจูุ ุงูุชุบููุฑ ูููู ูู ุงูู Infrastructure ููุท.
        
2. **ุงูุชุนููุฏ (Complexity Encapsulation):**
    
    ูู ุงููุดุงุฑูุน ุงูุญููููุฉุ ุงูู Query ูุด ุจุณ `Find(id)`.
    
    ูููู ุชููู: _"ูุงุช ูู ุงููุณุชุฎุฏููู ุงููู ุงุดุชุฑุงููู ูุนุงูุ ูุนูุฑูู ููู 20ุ ูุฑุชุจูู ุญุณุจ ุงูุงุณูุ ูุงุนูู Include ููุนูุงููู"_.
    
    - **ุจุฏูู Repo:** ูุฐุง ุงูููุฏ ุงูุทููู ุฑุญ ูุชูุฑุฑ ูู ูู Handler.
        
    - **ูุน Repo:** ุจุชุนูู ุฏุงูุฉ ุงุณููุง `GetActiveUsers()` ูุชุฎูู ูู ูุฐุง ุงูุชุนููุฏ ุฏุงุฎููุง.
        
3. **ุงูุงุฎุชุจุงุฑ (Unit Testing):**
    
    ุนูู Mock ูู `ISubscriptionsRepository` ุฃุณูู ุจููููู ูุฑุฉ ูู ุนูู Mock ูู `DbContext` ู `DbSet` (ุงููู ูู ูุงุจูุณ ูุฃู ูุจุฑูุฌ).
    

### ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ ูููุญุงุถุฑ:

- ูู ุงููุดุงุฑูุน ุงูุตุบูุฑุฉ ุฌุฏุงู (CRUD): ุงุณุชุฎุฏู `DbContext` ูุจุงุดุฑุฉุ ูุง ุฏุงุนู ููุชุนููุฏ.
    
- ูู ุงููุดุงุฑูุน ุงููุชูุณุทุฉ ูุงููุจูุฑุฉ (Clean Architecture): **ุงุณุชุฎุฏู Repository & Unit of Work**. ุงููุงุฆุฏุฉ ุงูุชูุธูููุฉ ููุงุจููุฉ ุงูุงุฎุชุจุงุฑ (Testability) ุชุณุชุญู ุงูุฌูุฏ ุงูุฅุถุงูู.
    

### ุงูุทุฑููุฉ 1: ุจุฏูู Repository & Unit of Work (ุงุณุชุฎุฏุงู DbContext ูุจุงุดุฑุฉ) โ

ููุง ุณูููู ุจุญูู ุงูู `DbContext` (ุงูุชุงุจุน ูู EF Core) ูุจุงุดุฑุฉ ุฏุงุฎู ุงูู **Application Layer** (ูู ุงูู Handler).

C#

```
// ุฏุงุฎู Application/Handlers/GetSubscriptionHandler.cs

public class GetSubscriptionHandler
{
    // ูุงุฑุซุฉ 1: ุงูู Application ูุนุชูุฏ ุนูู EF Core ูุจุงุดุฑุฉ
    private readonly GymManagementDbContext _dbContext; 

    public GetSubscriptionHandler(GymManagementDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    public async Task Handle(...)
    {
        // ูุงุฑุซุฉ 2: ููุฏ ุงูุฏุงุชุงุจูุณ ุงููุนูุฏ (LINQ) ููุชูุจ ุฏุงุฎู ุงูุจุฒูุณ ููุฌูู
        var result = await _dbContext.Subscriptions
            .Where(s => s.UserId == request.UserId && s.Status == "Active") // ููุชุฑ
            .Include(s => s.Gyms) // ูุงุฑุซุฉ 3: Include ูู ุฏุงูุฉ ุฎุงุตุฉ ุจู EF Core
            .ToListAsync();
            
        // ูุงุฑุซุฉ 4: ูู ุฃุฑุฏูุง ุงูุชุนุฏูู
        // _dbContext.SaveChanges();
    }
}
```

#### ููุด ูุงุฏ ุงูุญูู "ุบูุท" ูู ุงููููู ุฃุฑููุชูุดุฑุ (Why No?)

1. **Leaky Abstraction (ุชุณุฑุจ ุงูุชูุงุตูู):** ูููุฉ `.Include()` ู `.ToListAsync()` ูู ูููุงุช ูุญุฌุฒุฉ ูู Entity Framework. ูู ูุฑุฑุช ุจูุฑุฉ ุชุณุชุฎุฏู **Dapper** ุฃู **MongoDB**ุ ุฑุญ ุชุถุทุฑ ุชุฏุฎู ุนูู ูุฐุง ุงูููู (ุงููู ูู Business Logic) ูุชูุณุญ ุงูููุฏ ูุชุนูุฏ ูุชุงุจุชู. **ููุง ุฃูุช ูุณุฑุช ูุงุนุฏุฉ ุงุณุชููุงููุฉ ุงูู Application.**
    
2. **ุชูุฑุงุฑ ุงูููุฏ:** ูู ุนูุฏู Handler ุซุงูู ุจูุญุชุงุฌ ููุณ ุงูุจูุงูุงุชุ ุฑุญ ุชุถุทุฑ ุชูุณุฎ ุงูู LINQ Query (`Where` & `Include`) ูุฑุฉ ุซุงููุฉ ููุงู.
    
3. **ุตุนูุจุฉ ุงูุชุณุช (Testing Nightmare):** ุนุดุงู ุชุนูู Unit Test ููุฐุง ุงูููุงุณุ ูุงุฒู ุชุนูู Mock ููู `DbContext` ูููู `DbSet`ุ ููุฐุง ุดูุก ุตุนุจ ุฌุฏุงู ููุนูุฏ ูู ุนุงูู ุงูุฏูุช ูุช.
    

---

### ุงูุทุฑููุฉ 2: ูุน Repository & Unit of Work (ุงูุญู ุงููุธูู) โ

ููุง ุณููุตู ุงูุฃููุฑ. ุงูู Application ูุทูุจ "ูุงุฐุง ูุฑูุฏ" ูุงูู Infrastructure ููุฑุฑ "ููู ูููุฐ".

#### 1. ุงููุงุฌูุฉ (ุฏุงุฎู Application Layer):

C#

```
// ูุฌุฑุฏ "ุนูุฏ" ูุธูู ุฌุฏุงู
public interface ISubscriptionsRepository
{
    // ูุงุญุธ: ูุง ููุฌุฏ ุฃู ุฐูุฑ ูู Include ุฃู EF Core
    Task<List<Subscription>> GetActiveSubscriptionsWithGymsAsync(Guid userId);
}
```

#### 2. ุงูุชูููุฐ (ุฏุงุฎู Infrastructure Layer):

ููุง ูุฎุจุฆ "ูุณุงุฎุฉ" ุงูุชุนุงูู ูุน ุงูุฏุงุชุงุจูุณ ูุงูุชูุงุตูู ุงูุชูููุฉ.

C#

```
public class SubscriptionsRepository : ISubscriptionsRepository
{
    private readonly GymManagementDbContext _dbContext;

    public SubscriptionsRepository(GymManagementDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    public async Task<List<Subscription>> GetActiveSubscriptionsWithGymsAsync(Guid userId)
    {
        // ููุง ููุชุจ ููุฏ EF Core ุจุฑุงุญุชูุง
        return await _dbContext.Subscriptions
            .Where(s => s.UserId == userId && s.Status == "Active")
            .Include(s => s.Gyms) // ุงูู Include ูุณููุญุฉ ููุง
            .ToListAsync();
    }
}
```

#### 3. ุงูุงุณุชุฎุฏุงู (ุฏุงุฎู ุงูู Handler):

C#

```
public class GetSubscriptionHandler
{
    private readonly ISubscriptionsRepository _repo; // ูุนุชูุฏ ุนูู ุงููุงุฌูุฉ ููุท

    public GetSubscriptionHandler(ISubscriptionsRepository repo)
    {
        _repo = repo;
    }

    public async Task Handle(...)
    {
        // ููุฏ ูุธููุ ููุฑูุกุ ููุณุชูู ุนู ุงูุฏุงุชุงุจูุณ
        var result = await _repo.GetActiveSubscriptionsWithGymsAsync(request.UserId);
    }
}
```

#### ููุด ูุงุฏ ุงูุญูู "ุตุญ"ุ (Why Yes?)

1. **ูุตู ุชุงู (Decoupling):** ุงูู Handler ูุง ุจูุนุฑู ุฅููุง ุจูุณุชุฎุฏู EF Core. ูู ุบูุฑูุง ุงูููุฏ ูู ุงูู Repository ููุณุชุฎุฏู SQL ูุจุงุดุฑุ ุงูู Handler ูุง ุฑุญ ูุญุณ ููุง ูุชุบูุฑ.
    
2. **ุณูููุฉ ุงูุชุณุช (Easy Testing):** ููุง ุชูุฌู ุชุนูู Test ููู Handlerุ ุจุชูุฏุฑ ุชุนูู Mock ุจุณูุท ุฌุฏุงู ููู Interface ูุชูููู: "ููุง ุงูุงุฏููุ ุฑุฌุน ูู ุฏุงุชุง ููููุฉ"ุ ุจุฏูู ูุง ุชูุฌุน ุฑุงุณู ุจุงูู DbContext.
    
3. **ูุฑูุฒูุฉ ุงูููุฏ:** ููุฏ ุงูู Query (`Where` + `Include`) ููุชูุจ ูุฑุฉ ูุงุญุฏุฉ ูู ุงูุฑูุจูุณุชูุฑู. ุฃู ุญุฏ ุจูุญุชุงุฌู ุจููุงุฏูู.
    

---

### ุงูุขู ูุฃุชู ูุณุคุงูู ุนู ุงูู Unit of Work ุชุญุฏูุฏุงู

ูู ุงูุทุฑููุฉ ุงูุฃููู (ุงูุบูุท)ุ ููุช ุจุชุนูู ููู ูู ููุงูุฉ ุงูู Handler:

C#

```
await _dbContext.SaveChangesAsync(); // Handler is calling Save directly
```

ูู ุงูุทุฑููุฉ ุงูุซุงููุฉ (ุงูุตุญ)ุ ุฅุญูุง ุนูููุง ุงูุชุงูู:

**ูู Infrastructure:**

ุฌุนููุง ุงูู `DbContext` ูู ููุณู ูููุฐ ุงูู `IUnitOfWork`.

C#

```
// GymManagementDbContext.cs
public class GymManagementDbContext : DbContext, IUnitOfWork 
{
    // ...
    
    // ุชูููุฐ ุงููุงุฌูุฉ ุงููู ุนุฑููุงูุง ูู ุงูุงุจูููุดู
    public async Task CommitChangesAsync()
    {
        // ุจุจุณุงุทุฉ ุจููุงุฏู ูุธููุฉ EF Core ุงูุฃุตููุฉ
        await base.SaveChangesAsync();
    }
}
```

**ููุด ุงูููุฉ ูุงูุ ููุด ูุง ููุงุฏู `SaveChangesAsync` ูุฎูุตุ**

ุนุดุงู ุงูู Application Layer **ููููุน ูุดูู** ููุงุณ `DbContext` ูุฃูู ุชุงุจุน ูููุชุจุฉ ุฎุงุฑุฌูุฉ.

ูุฅุญูุง "ุฎุฏุนูุง" ุงูู Application Layer:

ูููุง ูู: _"ุฎุฐ ูุฐู ุงููุงุฌูุฉ `IUnitOfWork`ุ ูููุง ุฒุฑ ุงุณูู `CommitChangesAsync`ุ ููุง ุชุฎูุต ุดุบู ุงูุจุณ ุนููู"_.

- ุงูู Application ุจููุจุณ ุงูุฒุฑ ููู ูููุฑ ุฅูู ุจูููู ุงูุชุฑููุณ ุนุงุฏู.
    
- ูู ุงููุงูุน (Runtime): ุงููู ุจูุฑุฏ ุนููู ูู ุงูู `DbContext` ูุจูุนูู `SaveChanges`.
    

### ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ ุจุงูุนุงููุฉ:

1. **ููุด EF Core ูุญุงููุง ูุด ููุงูุฉุ**
    
    ูุฃูู ูู ุงุณุชุฎุฏูุชูุง ูุจุงุดุฑุฉุ ููุฏ ุงูุจุฒูุณ ุชุจุนู ุฑุญ ูุตูุฑ "ูุฏูู" ุนูููุงุ ูุจูุฑุฉ ูู ุญุจูุช ุชุบูุฑูุง ุฃู ุชุนูู Unit Testุ ุฑุญ ุชุชุบูุจ ุบูุจุฉ ุงูุณููู.
    
2. **ุดู ุนูููุงุ**
    
    ุนูููุง "ุบูุงู" (Wrapper) ุญูููุง.
    
    - ุงูู **Repository** ุบูู ุงูู `DbSet` ูุนูููุงุช ุงูู Query.
        
    - ุงูู **Unit of Work** ุบูู ุงูู `DbContext` ูุนูููุฉ ุงูู `SaveChanges`.
        

ุจูููุ ุงูู Application Layer ุจูุถู "ูุธูู" ูุจูุชุนุงูู ุจุณ ูุน "ุงูุบูุงู" ููุง ุจูุนุฑู ุดู ูู ุฌูุงุชู.

ูู ูุตูุช ุงูููุฑุฉ ููุด ุงูุชุนุจ ูุฐุง ููู ูุณูู ูู ุงููุดุงุฑูุน ุงููุจูุฑุฉุ


---










---

### 1. ุงููุฑู ุจูู Clean Architecture ู Domain-Driven Design (DDD)

ุฃูู ุดู ูุงุฒู ุชูุฑู ุจูููู ุนุดุงู ูุง ุชุฎูุท ุงูุฒูุช ุจุงููู.

- **ุงูู Clean Architecture (ุงููุธุงูุฉ ุงููุนูุงุฑูุฉ):**
    
    - ูุฐู ุนุจุงุฑุฉ ุนู **"ูููู" (Structure)**.
        
    - ุจุชูููู: "ููู ุชุญุท ูููุงุชูุ ูููู ูุณููุญ ูุญูู ูุน ูููุ".
        
    - **ุชุดุจูู:** ูุซู ูุฎุทุท ุงูุจูุช ุงูููุฏุณู (ููู ุงููุทุจุฎุ ููู ุงูุญูุงูุ ููู ุบุฑูุฉ ุงูููู).
        
- **ุงูู Domain-Driven Design (DDD):**
    
    - ูุฐู ุนุจุงุฑุฉ ุนู **"ููุฌ ุฃู ุฃุณููุจ ุชูููุฑ" (Approach)**.
        
    - ุจุชูููู: "ููู ุชุญูู ูุดุงูู ุงูุจูุฒูุณ ุงููุนูุฏุฉ (ุฒู ูุธุงู ุจูู ุฃู ุฌูู) ุฅูู ููุฏ ูููุงุณุงุช ุจุชูุซู ุงููุงูุน".
        
    - **ุชุดุจูู:** ูุซู "ุงูุฏูููุฑ ุงูุฏุงุฎูู ููุธุงู ุงูุญูุงุฉ ุฌูุง ุงูุจูุช". ููู ุงููุงุณ ุจุชุชุญุฑูุ ุดู ููุงููู ุงูุจูุชุ
        

**ุงูุฒุจุฏุฉ:** ุงูู Clean Architecture ุจุชูุธู ุงููููุงุชุ ูุงูู DDD ุจุชูุธู "ุทุฑููุฉ ุชูููุฑู" ูู ุญู ุงููุดููุฉ. ูุจููุฏุฑ ูุณุชุฎุฏููู ูุน ุจุนุถ (ููุฐุง ุงูุฃูุถู) ุฃู ูู ูุงุญุฏ ูุญุงู.

---

### 2. ูุง ูู ุงูู Domain ุฃุตูุงูุ ๐

ูุจู ูุง ูุญูู ุนู ุงูุชุตูููุ ุดู ูุนูู **Domain**ุ

- ุงูู **Domain** ูู **"ุงููุฌุงู"** ุฃู **"ุงููุดููุฉ"** ุงููู ุฅูุช ุฌุงู ุชุญููุง.
    
- ูู ูุดุฑูุนูุง: ุงูุฏูููู ูู "ุฅุฏุงุฑุฉ ุงูุฌูู ูุงูุงุดุชุฑุงูุงุช".
    
- ูู ุชุทุจูู ุจููู: ุงูุฏูููู ูู "ุงูุญุณุงุจุงุช ูุงูุชุญูููุงุช".
    

**ููุณูุฉ DDD:**

ุจุชูููู ูุงุฒู ุงูููุฏ ุชุจุนู ูููู **ูุฑุขุฉ** ูููุงูุน.

ูุนูู ูู ุฎุจูุฑ ุฑูุงุถุฉ (ูุฏุฑุจ ุฌูู) ูุฑุฃ ุงูููุฏ ุชุจุนูุ ูุงุฒู ูููู ุงููุตุทูุญุงุช (Gym, Subscription, Room) ููููู ุงูููุงูููุ ุญุชู ูู ูุง ุจูุนุฑู ุจุฑูุฌุฉ! ูุงุฒู ูุณุชุฎุฏู **"ูุบุฉ ููุญุฏุฉ"**.

---

### 3. ูุง ูู ุงูู Domain Modelุ (ูููุฐุฌ ุงููุฌุงู) ๐ฆ

ููุง ุจุฏุฃูุง ุจุงูููุงู ุงูุชููู ุงูููู.

- ูู ุงูุจุฑูุฌุฉ ุงูุนุงุฏูุฉุ ุงูููุงุณ ุนุจุงุฑุฉ ุนู ุดููุฉ Properties (ุฏุงุชุง).
    
- ูู ุงูู DDDุ ุงูู **Domain Model** ูู ูุงุฆู ูุญุชูู ุนูู ุดุบูุชูู ูุน ุจุนุถ:
    
    1. **ุจูุงูุงุช (Data):** (ุงูุงุณูุ ุงูุงูุฏูุ ุงูุณุนุฑ).
        
    2. **ุณููู (Behavior):** (ุฏูุงูุ ูุธุงุฆูุ Logic).
        

**ููุดุ** ูุฃู ูู ุงููุงูุนุ "ุงูุงุดุชุฑุงู" ูุด ูุฌุฑุฏ ูุฑูุฉ ููุชูุจ ุนูููุง ุจูุงูุงุชุ ุงูุงุดุชุฑุงู ูู ุดู "ุจููุนููู ุชุฌุฏูุฏ"ุ "ุจูููุบู"ุ "ุจููุถุงู ุนููู ุฌูู". ูุงุฒู ุงูููุงุณ ููุซู ูุฐุง ุงูุณููู.

---

### 4. ุงููุนุฑูุฉ ุงููุจุฑู: Rich vs. Anemic Domain Models โ๏ธ

ูุฐู ุฃูู ููุทุฉ ูู ุงูููุฏููุ ูุฑูุฒ ูุนู ูููุง 100%.

#### ุฃ- ุงููููุฐุฌ ุงููุตุงุจ ุจููุฑ ุงูุฏู (Anemic Domain Model) โ

ูุฐุง ุงููู ุฃุบูุจูุง ุจูุนูููุ ููู ูุนุชุจุฑ **Anti-Pattern (ููุงุฑุณุฉ ุณูุฆุฉ)** ูู ุงูู DDD.

- **ุดููู:** ููุงุณ ููู ุจุณ `public get; set;` ููุง ููู ุฃู ุฏูุงู (Methods).
    
- **ููู ุจูุดุชุบู:** ุจูุณูู ุจูุงูุงุชู ูุฃู ุญุฏุง (Service ุฎุงุฑุฌูุฉ) ุนุดุงู ุชุนุฏู ุนููู.
    
- **ุงููุดููุฉ:** ุงูููุงุณ "ูุด ูุณูุทุฑ" ุนูู ุญุงูู. ุฃู ุญุฏุง ุจููุฏุฑ ูุบูุฑ ุงูู List ุชุจุนุช ุงูุบุฑูุ ููุณุญุ ูุถููุ ูุฎุฑุจ ุงูุฏุงุชุงุ ูุงูููุงุณ ูุงุนุฏ ูุชูุฑุฌ.
    
    - _ูุซุงู:_ ุงูู Service ุจุชููู: `gym.Rooms.Add(newRoom)`. ุงูุฌูู ูุง ุงูู ุฑุฃูุ ูููู ุงูุบุฑูุฉ ุชููู ุบูุทุ ุฃู ุงูุนุฏุฏ ุฒุงุฏ ุนู ุงูุญุฏ ุงููุณููุญ.
        

#### ุจ- ุงููููุฐุฌ ุงูุบูู (Rich Domain Model) โ

ูุฐุง ูู ุงูุตุญ ูู ุงูู DDD.

- **ุดููู:** ุงูุจูุงูุงุช ูุฎููุฉ (`private` ุฃู `readonly`).
    
- **ููู ุจูุดุชุบู:** ุงูููุงุณ "ุฐูู" ู"ูุณูุทุฑ". ููููุน ุญุฏุง ูููุณ ุงูุฏุงุชุง ุชุจุนุชู ุฅูุง ุนู ุทุฑูู "ุฏูุงู ูู ุณุงูุญ ูููุง".
    
- **ุงูููุฒุฉ:**
    
    - ุจุฏู ุชุถูู ุบุฑูุฉุ ูุง ุจุชุนูู `Add` ุนุงูููุณุช ูุจุงุดุฑุฉ.
        
    - ุจุชูุงุฏู ุฏุงูุฉ ุจุงูุฌูู ุงุณููุง: `gym.AddRoom(room)`.
        
    - ุฌูุง ุงูุฏุงูุฉุ ุงูุฌูู ุจูุดูู: "ูู ุงูุนุฏุฏ ูุณููุญุ ูู ุงูุบุฑูุฉ ููุฌูุฏุฉุ" ุฅุฐุง ุชูุงู ุจุถูููุง.
        
- **ุงููุชูุฌุฉ:** ูุณุชุญูู ุงูุฏุงุชุง ุชุฎุฑุจุ ูุฃู ุงูุฌูู ูู ุงููู ุจูุญูู ููุณู (Encapsulation).
    

**ููู ูุญูู ุงูููุฏูู ูู Richุ**

1. ุฎูู ุงูุญููู `private` ู `readonly` ูุฏุฑ ุงูุฅููุงู.
    
2. ูุง ุชูุดู ูู ุดู ููุนุงูุฉ (Expose only what is needed).
    
3. ุงูุดู "ุฏูุงู" (Methods) ุจุชุนูู ุฃูุดูุ ุจุฏู ูุง ุชูุดู "ุจูุงูุงุช" ูุชุฎูู ุบูุฑู ูุนุฏููุง.
    

---

### 5. Always Valid Domain Model (ูููุฐุฌ ุตุงูุญ ุฏุงุฆูุงู) ๐ก๏ธ

ูุฐุง ูุจุฏุฃ ูููู ููู ูุจูู.

- **Not Always Valid (ูุด ุฏุงุฆูุงู ุตุงูุญ):**
    
    ูููู ุชุนูู ูุงุฆู `Car` ุจุณ ุชูุณู ุชุญุทูู `Wheels`. ุงููุงุฆู ุงูุฎููุ ุจุณ ูู "ุฎุฑุจุงู" (Invalid). ุนุดุงู ุชุณุชุฎุฏูู ูุงุฒู ุชุถู ุชุนูู `if (car.IsValid)`. ูุฐุง ุจูุนูู ููุฏ ูููุซ ุจู If statements.
    
- **Always Valid (ุตุงูุญ ุฏุงุฆูุงู):**
    
    ุงููุงุฆู **ูุณุชุญูู ููุฎูู** ุฅูุง ุฅุฐุง ูุงู ุตุญ 100%.
    
    - ุจุฏู ุชุนูู ุณูุงุฑุฉุ ุงูู Constructor ุจูุฌุจุฑู ุชุนุทูู ุนุฌุงู ูููุชูุฑ.
        
    - ูู ุฃู ูุญุธุฉ ุจุชุณุชุฎุฏู ุงููุงุฆูุ ุฅูุช "ูุงุซู" ุฅูู ุณููู ูุจูุงูุงุชู ุตุญูุญุฉ. ูุง ูู ุฏุงุนู ุชุดูู ุนููู ูู ูุฑุฉ.
        

**ุงููุงุนุฏุฉ:** ุงููุน ุงูุฎุทุฃ ูู ุงููุตุฏุฑ (ุนูุฏ ุงูุฅูุดุงุก)ุ ุจุฏู ูุง ุชุนุงูุฌู ูุงุญูุงู.

---

### 6. Persistence Ignorance (ุชุฌุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช) ๐

ูุฐุง ุงููุจุฏุฃ ุงูุฃุฎูุฑ.

- **ูุนูุงู:** ููุง ุชุตูู ุงูู Domain Model (ููุงุณ ุงูุฌูู ุฃู ุงูุงุดุชุฑุงู)ุ **ุฅูุงู ุซู ุฅูุงู** ุชููุฑ ูู ุงูุฏุงุชุงุจูุณ!
    
- ูุง ุชููุฑ "ููู ุฑุญ ูุชุฎุฒู ูู SQLุ" ุฃู "ููู ุฑุญ ููุนููู Joinุ".
    
- ุตูู ุงูููุงุณ ููุฃูู ุฑุญ ูุนูุด ูู ุงูููููุฑู ูุจุณ.
    

**ููุดุ**

- ุนุดุงู ููุฏ ุงูุจูุฒูุณ ูุถู ููู (Pure).
    
- ููุถูุน ุงูุชุฎุฒูู ูุฐุง ูุธููุฉ ุงูู **Infrastructure** (ุฒู ูุง ุดููุง ุจุงูู Repository Pattern).
    
- ูู ุฑุจุทุช ุงูููุฏูู ุจุงูุฏุงุชุงุจูุณุ ุจูุฑุฉ ูู ุบูุฑุช ุงูุฏุงุชุงุจูุณุ ุงูุจูุฒูุณ ููุฌูู ุฑุญ ูููุณุฑ.
    

---

### ููุฎุต "ุงูุฒุจุฏุฉ" ุนุดุงู ุชุซุจุช ุงููุนูููุฉ ๐ง:

1. **DDD** ูู ุฃุณููุจ ุชูููุฑ ุจุฎูู ุงูููุฏ ูุดุจู ุงููุงูุน.
    
2. **Domain Model** = ููุงุณ ููู ุฏุงุชุง + ูุธุงุฆู (ูุด ุจุณ ุฏุงุชุง).
    
3. **Rich Model** = ููุงุณ ุจูุญูู ุญุงูู (ุจูุงูุงุชู Privateุ ูุงูุชุนุฏูู ุนู ุทุฑูู Functions). **(ูุฐุง ุงููู ุฑุญ ูุณุชุฎุฏูู)**.
    
4. **Anemic Model** = ููุงุณ ุถุนูู (ููู Public set) ูุฃู ุญุฏุง ุจููุนุจ ููู **(ูุฐุง ุบูุท)**.
    
5. **Always Valid** = ุงููุงุฆู ูุง ุจููุฎูู ุฅูุง ููู ูุงูู ูุตุญูุญ.
    
6. **Persistence Ignorance** = ุตูู ุงูููุงุณุงุช ููุง ุชูุชู ููู ุฑุญ ุชุชุฎุฒู ูู ุงูุฏุงุชุงุจูุณ.
    

ูุฐุง ูู ุงูุฃุณุงุณ ุงููุธุฑู ุงููู ุฑุญ ูุจูู ุนููู ุงููุญุงุถุฑ ุงูููุฏ ุงููุงุฏู ูู ุทุจูุฉ ุงูู Domain. ูู ุงูุตูุฑุฉ ูุถุญุช ุงูุขูุ



----










### 1. ุงูุญูููุฉ ุงูุตุงุฏูุฉ: ูู ุฃูู ูุจุฏุฃ ุงูุจูุงุกุ ๐๏ธ

ูู ุงูููุฑุณุ ุจุฏุฃูุง ูู ุงูุฎุงุฑุฌ (ุงูู Controller) ูุฏุฎููุง ููุฏุงุฎู.

ููู ุงููุญุงุถุฑ ูููู: **"ุฅุฐุง ููุช ูุงูู Clean Architecture ุตุญุ ูุงุฒู ุชุจุฏุฃ ูู ุงูู Domain Layer ุฃููุงู"**.

#### ููุด ูุจุฏุฃ ูู ุงูุฏููููุ (Why?)

ููุง ุชููู ุงููููุฉ ุงูุญููููุฉ ุงููู ุทูุจุช ุดุฑุญูุง. ููุด ุฃุจุฏุฃ ุจูุชุงุจุฉ ููุงุณ `Subscription` ู `Gym` ูุจู ูุง ุฃุนูู ุฏุงุชุงุจูุณ ุฃู APIุ

1. **ุงุฎุชุจุงุฑ ุงูููุทู ุฃููุงู (Test Core Logic):**
    
    ุงูุฏูููู ูู ุงูููุงู ุงููู ููู "ููุงููู ุงูุจูุฒูุณ" (ูุซูุงู: ููููุน ุงูุงุดุชุฑุงู ูููู ููู ุฃูุซุฑ ูู 3 ุฌููุงุช). ููุง ุชุจุฏุฃ ูููุ ุจุชูุฏุฑ ุชูุชุจ **Unit Tests** ูุชุชุฃูุฏ ุฅู ุงูููุงููู ุดุบุงูุฉ ุตุญ 100% ุจุฏูู ูุง ุชุถูุน ููุชู ูู ุชุดุบูู ุณูุฑูุฑ ุฃู ุฏุงุชุงุจูุณ.
    
2. **ุชุฌูุจ ุงูููุฏ ุงูุฑูุชููู (Avoid Boilerplate):**
    
    ุชุฎูู ุฅูู ุจููุช ุงูู Controllerุ ูุงูู Databaseุ ูุงูู Repositoryุ ูุจุนุฏูู ุงูุชุดูุช ุฅู ุชุตููู "ุงูุงุดุชุฑุงู" ุชุจุนู ุบูุท ููุงุฒู ุชุบูุฑู! ุฑุญ ุชุถุทุฑ ุชูุฏ ูู ุงููู ุจููุชู (ุงูู Controller ูุงูู DB).
    
    ุจูููุง ูู ุจุฏุฃุช ุจุงูุฏููููุ ุฅูุช ุจุชุจูู "ุงูููุจ" ูุชุชุฃูุฏ ูููุ ูุจุนุฏูู ุจุชุจูู ุงููุดุฑุฉ ุงูุฎุงุฑุฌูุฉ (Boilerplate) ูุฑุฉ ูุงุญุฏุฉ ูุฃูุช ูุฑุชุงุญ.
    
3. **ุงูุชุฑููุฒ (Focus):**
    
    ููุง ุชุจุฏุฃ ุจุงูุฏููููุ ุชุฑููุฒู ุจูููู ููุตุจ ุนูู "ุญู ูุดููุฉ ุงูุนููู" ูุด ุนูู "ููู ุฃุดุจู SQL".
    

---

### 2. ุงูุนูุงุฑุฉ ูุชูุญูุฑุฉ ุญูู ุงูุฏูููู (Domain-Centric Architecture) ๐ฏ

ุงููุญุงุถุฑ ูุฐูุฑู ุจุฃู ูู ุงูุชุนุจ ุงููู ุชุนุจูุงู ูุงูุทุจูุงุช ุงููู ุนูููุงูุง ูุฏููุง ุดู ูุงุญุฏ: **ุญูุงูุฉ ุงูุฏูููู**.

- **ุงููุนูู:** ุงูุฏูููู ูู "ุงูููู" ุงูุฌุงูุณ ูู ุงููุฑูุฒ. ูู ุงูุทุจูุงุช ุงูุซุงููุฉ (Presentation, Infrastructure) ูู "ุฎุฏู" ููุฌูุฏูู ุนุดุงู ูููุฐูุง ุฃูุงูุฑ ุงููููุ ูุด ุงูุนูุณ.
    
- **ููุดุ** ูุฃู ุงูุชูููููุฌูุง ุจุชุชุบูุฑ (ุงูููู ููุจุ ุจูุฑุฉ ููุจุงููุ ุงูููู SQLุ ุจูุฑุฉ Mongo)ุ ุจุณ "ุงูุจูุฒูุณ" (ููุฑุฉ ุงูุฌูู ูุงูุงุดุชุฑุงูุงุช) ุซุงุจุชุฉ. ูุฅุญูุง ุจูุญูู ุงูุซุงุจุช ูู ุงููุชุบูุฑ.
    

---

### 3. ุงูููุฎุต ุงูููุงุฆู ูุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจ (The Grand Recap) ๐

ุจูุง ุฃููุง ูุตููุง ูุทุจูุฉ ุงูุฏููููุ ุงููุญุงุถุฑ ูุฎุต ูู ูุธููุฉ ูู ุทุจูุฉ ุจูุงุกู ุนูู ูุง ุชุนูููุงู ุญุชู ุงูุขูุ ูุชุฑุณูุฎ ุงูุตูุฑุฉ ุงููุจูุฑุฉ:

#### ุฃ. ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer) ๐ฃ๏ธ

- **ุงููุธููุฉ:** "ุงููุชุฑุฌู".
    
- **ูุงุฐุง ุชูุนู:** ุชุณุชูู ุงูุทูุจ ุงูุฎุงุฑุฌู (HTTP Request / JSON) ูุจุชุญููู ููุบุฉ ุจูููููุง ุงููุธุงู ุงูุฏุงุฎูู (Command ุฃู Query).
    
- **ูุซุงู:** ุจุชุงุฎุฏ JSON ููู `adminId` ูุจุชุญููู ูู `CreateSubscriptionCommand`.
    

#### ุจ. ุทุจูุฉ ุงูุชุทุจูู (Application Layer) ๐

- **ุงููุธููุฉ:** "ุงููุงูุณุชุฑู" ุฃู "ุงููุฏูุฑ".
    
- **ูุงุฐุง ุชูุนู:** ูู ูุง ุจุชุดุชุบู ุจุฅูุฏูุงุ ูู ุจุชูุฒุน ุงูุฃุฏูุงุฑ:
    
    1. ุจุชููู ููุฑูุจูุณุชูุฑู: "ูุงุช ุงูุฏุงุชุง".
        
    2. ุจุชููู ููุฏูููู ููุฏูู: "ููุฐ ุงูููุทู (ูุซูุงู: ุฃุถู ุฌูู)".
        
    3. ุจุชููู ููุฑูุจูุณุชูุฑู: "ุงุญูุธ".
        
- **ููุงุญุธุฉ:** ูู ุจุชูุณู ุงูู Use Case (ุญุงูุฉ ุงูุงุณุชุฎุฏุงู) ูุงููุฉ.
    

#### ุฌ. ุทุจูุฉ ุงูุจููุฉ ุงูุชุญุชูุฉ (Infrastructure Layer) ๐ท

- **ุงููุธููุฉ:** "ุงูุนุงูู" (ุงููููุฐ).
    
- **ูุงุฐุง ุชูุนู:** ูู ุงููู ุจุชููุฐ ุงููุงุฌูุงุช (Interfaces) ุงููู ุนุฑูุชูุง ุงูุทุจูุงุช ุงูุฏุงุฎููุฉ.
    
    - ุงูู Application ุทูุจ `ISubscriptionsRepository`ุ ุงูู Infrastructure ุจุชุนุทูู `EfCoreRepository`.
        
    - ุงูู Domain ุทูุจ `IEmailSender`ุ ุงูู Infrastructure ุจุชุนุทูู `SmtpEmailSender`.
        

#### ุฏ. ุทุจูุฉ ุงููุฌุงู (Domain Layer) ๐ง

- **ุงููุธููุฉ:** "ุงูุฎุจูุฑ" ุฃู "ุงูุนูู".
    
- **ูุงุฐุง ุชูุนู:** ุชุญุชูู ุนูู ุงูููุงูุงุช (Entities) ูุงูููุงููู (Rules). ูู ุงูุทุจูุฉ ุงููุญูุฏุฉ ุงููู ูุง ุจุชุนุชูุฏ ุนูู ุฃู ุญุฏุงุ ูุงููู ุจูุนุชูุฏ ุนูููุง.
    

### ุงูุฎูุงุตุฉ "ุงูุฒุจุฏุฉ":

ุงููุญุงุถุฑ ุจููููู: **"ุตุญ ุฅุญูุง ุดุฑุญูุง ุงูุฏูููู ุขุฎุฑ ุดูุ ุจุณ ููุง ุชุฑูุญ ุชุดุชุบู ูู ูุดุฑูุน ุญููููุ ุงุจุฏุฃ ููู ุฃูู ุดู"**.

ูุฐุง ุจูุถูููู ุฅูู ุชุจูู ูุธุงู ููู ูู ุงูุฏุงุฎูุ ูุจุนุฏูู ุชุบููู ุจุงูุชูููููุฌูุง ุงูููุงุณุจุฉ.



---









---

### 1. ูุดููุฉ ุงูู Enums ุงูุนุงุฏูุฉ ูุญููุง (Smart Enums) ๐ง

**ุงููุดููุฉ:**

ูู ุงูุณู ุดุงุฑุจุ ุงูู `Enum` ุงูุนุงุฏู ูู ูู ุงูุญูููุฉ ูุฌุฑุฏ "ุฑูู" (Integer).

- ูู ุนูุฏู `Type` (Free=0, Pro=1).
    
- ูููู ูุจุฑูุฌ ุจุงูุบูุท ูุนูู `(SubscriptionType)100`. ุงููููุจุงููุฑ ุฑุญ ููุงูู! ููู ุงูุฑูู 100 ุบูุฑ ููุฌูุฏุ ููุฐุง ูุณุจุจ ูุดุงูู ูู ุงูุจูุฒูุณ.
    
- ุงูู Enum ุงูุนุงุฏู ูุง ูููู ุฃู ูุญุชูู ุนูู "ุณููู" (Behavior).
    

**ุงูุญู:** ุงุณุชุฎุฏุงู ููุชุจุฉ **Ardalis.SmartEnum**.

ูุฐู ุงูููุชุจุฉ ุชุญูู ุงูู Enum ูู ูุฌุฑุฏ ุฑูู ุบุจู ุฅูู **ููุงุณ ุญูููู (Class)**.

**ุงูุชุทุจูู:**

1. ุฃุถุงู ููุชุจุฉ `Ardalis.SmartEnum` ููุดุฑูุน ุงูู Domain.
    
2. ุฃูุดุฃ ููุงุณ `SubscriptionType`.
    
3. ุนุฑู ุจุฏุงุฎูู ุงูุฃููุงุน ูู `static instances`:
    
    - `Free` (ูููุชู 0).
        
    - `Starter` (ูููุชู 1).
        
    - `Pro` (ูููุชู 2).
        

**ุงููุงุฆุฏุฉ:** ุงูุขู ูุณุชุญูู ูููู ุนูุฏู ููุน ุงุดุชุฑุงู "ุบูุฑ ูุนุฑู". ูุง ุฅูุง ูู Freeุ Starterุ ุฃู Pro. ุงูุชูู ุฒูู ุงูุฃุฑูุงู ุงูุนุดูุงุฆูุฉ.

---

### 2. ุชุญููู ุงูู Subscription ุฅูู "Rich Model" ๐

ููุง ูููุง ุจุชูุธูู ููุงุณ `Subscription` ูู "ููุฑ ุงูุฏู" (Anemia) ูุฌุนููุงู ุบููุงู.

**ุงูุชุบููุฑุงุช:**

1. **ุฅูุบุงุก ุงูู Setters:** ุฌุนููุง ุงูุฎุตุงุฆุต (`Properties`) ูููุฑุงุกุฉ ููุท ุฃู `private set`. ููููุน ูุฃู ุดุฎุต ูุบูุฑ ุงูููุน ุฃู ุงูู AdminId ุจุนุฏ ุงูุฅูุดุงุก.
    
2. **ุฅุถุงูุฉ Constructor (ุงูููู ุฌุฏุงู):**
    
    - ุงููููุณุชุฑูุชูุฑ ูุฌุจุฑู ุฃู ุชุนุทู `SubscriptionType` ู `AdminId`.
        
    - ุงููููุณุชุฑูุชูุฑ ูููู ุจุชูููุฏ `Id` ุฌุฏูุฏ ุฅุฐุง ูู ุชุนุทู ูุงุญุฏุงู.
        
    - **ุงููุชูุฌุฉ:** ุฃุตุจุญ ุงูููุงุณ ูุทุจู ูุจุฏุฃ **Always Valid**. ูุณุชุญูู ููุฎูู ุงุดุชุฑุงู ุจุฏูู ููุน ุฃู ุจุฏูู ุฃุฏูู.
        

C#

```
public class Subscription
{
    // ูุงุญุธ: ูุง ููุฌุฏ Public Setter
    public SubscriptionType SubscriptionType { get; private set; }
    public Guid AdminId { get; private set; }

    // ุงููููุณุชุฑูุชูุฑ ูู ุงูุจูุงุจุฉ ุงููุญูุฏุฉ ููุฏุฎูู
    public Subscription(SubscriptionType subscriptionType, Guid adminId, Guid? id = null)
    {
        SubscriptionType = subscriptionType;
        AdminId = adminId;
        Id = id ?? Guid.NewGuid(); // ูู ูุง ุนุทูุชูู ุขูุฏูุ ุฃูุง ุจุฎุชุฑุน ูุงุญุฏ
    }
}
```

---

### 3. ุชุญุฏูุซ ุงูู Application Layer (ุชุฃุซูุฑ ุงูุฏูููู) ๐

ุจูุง ุฃู ุงูุฏูููู (ุงูููู) ุชุบูุฑุ ุงูุญุงุดูุฉ (Application) ูุงุฒู ุชุชุนุฏู.

- **ูู ุงูู Command:**
    
    - ูุงู ูุณุชูุจู `string SubscriptionType`.
        
    - ุฃุตุจุญ ูุณุชูุจู `SubscriptionType` (ุงูููุงุณ ุงูุฐูู).
        
    - **ููุดุ** ุนุดุงู ูุถูู ุฅู ุงูู Application Layer ุจูุชุนุงูู ูุน ุฃููุงุน ุตุญูุญุฉ ููุท.
        
- **ูู ุงูู Handler:**
    
    - ุชุนุฏูู ุทุฑููุฉ ุฅูุดุงุก ุงูู `Subscription`.
        
    - ุจุฏูุงู ูู `new Subscription { ... }` (ุงูุชู ุชุนุชูุฏ ุนูู Setters).
        
    - ุฃุตุจุญูุง ูุณุชุฎุฏู `new Subscription(...)` (ุนู ุทุฑูู ุงููููุณุชุฑูุชูุฑ).
        

---

### 4. ุชุญุฏูุซ ุงูู Presentation Layer (ุงููุชุฑุฌู ูุงูุญุงุฑุณ) ๐ก๏ธ

ูุฐุง ูู ุงูุฌุฒุก "ุงูุฃูุซุฑ ุชุนููุฏุงู" ูู ุงูููุฏููุ ูุฃู ุงูู Controller ูุงุฌู ูุดููุฉ ุญููููุฉ.

**ุงููุดููุฉ:**

1. ุงูุนุงูู ุงูุฎุงุฑุฌู (Contracts) ุจูุจุนุช `Enum` ุนุงุฏู ุฃู `String` (ูุซู "Free").
    
2. ุงูุนุงูู ุงูุฏุงุฎูู (Domain) ูุง ุจูููู ุบูุฑ `SmartEnum`.
    
3. ููุฌุฏ ุชุดุงุจู ูู ุงูุฃุณูุงุก: `SubscriptionType` (ูู ุงูู Contracts) ู `SubscriptionType` (ูู ุงูู Domain).
    

**ุงูุญู ุฎุทูุฉ ุจุฎุทูุฉ:**

**ุฃ. ุญู ุชุดุงุจู ุงูุฃุณูุงุก (Aliasing):**

ุงุณุชุฎุฏู `using` ูุฅุนุทุงุก ุงุณู ูุณุชุนุงุฑ:

C#

```
using DomainSubscriptionType = GymManagement.Domain.Subscriptions.SubscriptionType;
```

ุงูุขู ููุง ููุชุจ `DomainSubscriptionType` ูู ููุตุฏ ุงูููุงุณ ุงูุฐูู.

**ุจ. ุงูุชุญูู ูุงูุชุญููู (Validation & Conversion):**

ุงูู Controller ูุงุฒู ูุดุชุบู "ุญุงุฑุณ".

ุงุณุชุฎุฏู ุฏุงูุฉ `TryFromName` ุงูููุฌูุฏุฉ ูู ููุชุจุฉ SmartEnum.

C#

```
// ูุญุงููุฉ ุชุญููู ุงููุต ุงููุงุฏู ูู ุงูุฑููููุณุช ุฅูู ุณูุงุฑุช ุงููู
if (!DomainSubscriptionType.TryFromName(
    request.SubscriptionType.ToString(), 
    out var subscriptionType)) // ุงููุชุบูุฑ ุงููู ุฑุญ ูุชุฎุฒู ููู ุงูููุน ูู ูุฌุญูุง
{
    // ุฅุฐุง ูุดู ุงูุชุญููู (ูุนูู ุงูุฑููููุณุช ุจุงุนุช ุงุณู ุบูุท)ุ ุฑุฌุน ุฎุทุฃ 400
    return Problem(
        statusCode: StatusCodes.Status400BadRequest, 
        detail: "Invalid Subscription Type");
}

// ุฅุฐุง ูุฌุญูุงุ ููู ูุงุฑุณู ุงููููุงูุฏ
var command = new CreateSubscriptionCommand(subscriptionType, ...);
```

---

### ุงูุฎูุงุตุฉ (ูุงุฐุง ุญูููุงุ):

1. **ุญูุงูุฉ ุงูุจูุงูุงุช:** ุงูุฏูููู ููุฏูู ุฃุตุจุญ ูุญุตูุงู (Private Setters + Constructor).
    
2. **ููุน ุงูููู ุงูุบูุท:** ุงูู Smart Enum ููุน ูุฌูุฏ ููู ุบูุฑ ููุทููุฉ.
    
3. **ูุตู ุงููุณุคูููุงุช:**
    
    - ุงูู **Controller** ูุณุคูู ุนู ุงูุชุฃูุฏ ุฅู ุงูู Input (ุงููุต) ุตุญูุญ ูููุฌูุฏ.
        
    - ุงูู **Application** ุจูุณุชูู ูุงุฆู ุฌุงูุฒ ูุตุญูุญ.
        
    - ุงูู **Domain** ุจูุญุชูู ุงูููุทู ูุงูููุงููู.
        




---












### ุงูุฌุฒุก ุงูุฃูู: ุงููุดููุฉ ุงูุชูููุฉ ูุญููุง (ุงูู Private Constructor) ๐๏ธ

ุจุนุฏ ุฃู ุฌุนููุง ุงูู `Subscription` ูุงุฆูุงู ุบููุงู (Rich Model) ูุญุฐููุง ุงูู Settersุ ูุงุฌููุง ูุดููุฉ ุนูุฏ ุงูุชุดุบูู: **Entity Framework Core (EF Core) ุชูููุช ุนู ุงูุนูู!**

#### 1. ููุงุฐุง ุชูููุชุ

EF Core ุนูุฏูุง ุชุฑูุฏ ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุงูุฏุงุชุงุจูุณ ูุชุญููููุง ููุงุฆู `Subscription`:

- ุชุจุญุซ ุนู **Constructor ูุงุฑุบ** (ุจุฏูู ุจุงุฑุงููุชุฑุงุช) ูุชูุดุฆ ุงููุงุฆู ุฃููุงู.
    
- ุซู ุชุจุญุซ ุนู **Setters** ูุชุนุจุฆุฉ ุงูุจูุงูุงุช (Id, SubscriptionType, etc).
    
- ููุญู ูููุง ุจุญุฐู ุงูุงุซููู ูู ุงูุฏุฑุณ ุงูุณุงุจู ูุญูุงูุฉ ุงูุฏูููู!
    

#### 2. ุงูุญู (ุงูุชูุงุฒู ุจูู ุงููุธุงูุฉ ูุงููุงูุนูุฉ):

ูุญู ูุฐู ุงููุดููุฉ ุฏูู ุงูุชุถุญูุฉ ุจูุจุงุฏุฆ ุงูู DDDุ ูููุง ุจุงูุชุงูู ูู ููุงุณ `Subscription`:

- **ุฅุถุงูุฉ Private Constructor:**
    
    C#
    
    ```
    private Subscription() { }
    ```
    
    ูุฐุง ุงููููุณุชุฑูุชูุฑ "ุณุฑู"ุ ูุง ูุฑุงู ุฃุญุฏ ุฅูุง ุงูููุงุณ ููุณู... ู **EF Core** (ูุฃููุง ุชุณุชุฎุฏู Reflection ูุชุณุชุทูุน ุฑุคูุฉ ุงูุฃุดูุงุก ุงูุฎุงุตุฉ).
    
- **ุฅุฑุฌุงุน ุงูู Setters ูู Private:**
    
    C#
    
    ```
    public Guid Id { get; private set; } // ูุงู ูููุฑุงุกุฉ ููุทุ ุฃุนุฏูุง private set
    ```
    
    ุจูุฐุงุ ุงููุจุฑูุฌ ุงูุนุงุฏู ูุง ูุณุชุทูุน ุงูุชุนุฏูู (ูุง ุฒุงู ูุญูู)ุ ููู EF Core ุชุณุชุทูุน ุงูุชุนุจุฆุฉ.
    

#### 3. ูู ูุฐุง ุฎุฑู ููุจุฏุฃ Persistence Ignoranceุ ๐ค

ูุนู ููุง.

- **ูุธุฑูุงู:** ูุนูุ ูุญู ุนุฏููุง ุงูุฏูููู ุนุดุงู ุฎุงุทุฑ ุงูุฏุงุชุงุจูุณ.
    
- **ุนูููุงู:** ูุฐุง "ุดุฑ ูุง ุจุฏ ููู". ุงูุจุฏูู ูู ุนูู ููุงุณุงุช ูููุตูุฉ ููุฏุงุชุงุจูุณ ููุณุฎ ุงูุจูุงูุงุช (Mapping)ุ ููุฐุง ุชุนููุฏ ูุง ุฏุงุนู ูู ูู ูุนุธู ุงููุดุงุฑูุน. ูุงูุญู ุงูุฐู ูุฏูู ุงููุญุงุถุฑ ูู ุงูุญู ุงููุณุท ุงููุชูู ุนููู ูู ุงูุตูุงุนุฉ.
    

---

### ุงูุฌุฒุก ุงูุซุงูู: ุถุจุท ุฅุนุฏุงุฏุงุช ุงูุฏุงุชุงุจูุณ (EF Core Configuration) โ๏ธ

ููู ูุนูู ูู ุดูุก ุจุชูุงุบูุ ุฎุงุตุฉ ูุน ุงูู SmartEnum ูุงูู Private Settersุ ูุญุชุงุฌ ููุชุงุจุฉ "ุชุนูููุงุช" ูู EF Core ูู ุทุจูุฉ ุงูู Infrastructure.

**ูู ููู `SubscriptionConfigurations.cs`:**

1. **ุชุญุฏูุฏ ุงูููุชุงุญ (Key):**
    
    `builder.HasKey(s => s.Id);`
    
    `builder.Property(s => s.Id).ValueGeneratedNever();` (ูุฃููุง ูุญู ูู ูููุฏ ุงูู GUID ูู ุงูููุฏ ูููุณ ุงูุฏุงุชุงุจูุณ).
    
2. **ุงูุชุนุงูู ูุน ุงูุญููู ุงูุฎุงุตุฉ (Private Fields):**
    
    `builder.Property(s => s.AdminId);`
    
    EF Core ุฐููุฉ ุจูุง ูููู ููุชุนุงูู ูุน ุงูู Private Properties ุทุงููุง ุฐูุฑูุงูุง ููุง.
    
3. **ุชุญููู ุงูู SmartEnum (Conversion):** ๐
    
    ูุฐู ุฃูู ููุทุฉ. ุงูุฏุงุชุงุจูุณ ูุง ุชููู ููุงุณ `SubscriptionType`ุ ูุฐูู ูููุง ูู EF Core:
    
    - **ุนูุฏ ุงูุญูุธ (To Database):** ุฎุฐ `subscriptionType.Value` (ุงูุฑูู 0, 1, 2).
        
    - **ุนูุฏ ุงููุฑุงุกุฉ (From Database):** ุฎุฐ ุงูุฑูู ูุงุณุชุฎุฏู `SubscriptionType.FromValue()` ูุชุฑุฌุน ุงููุงุฆู ุงูุฐูู.
        

---

### ุงูุฌุฒุก ุงูุซุงูุซ: ุงูุฌููุฉ ุงูุดุงููุฉ ูู ุงูููุฏ (Code Walkthrough) ๐ถโโ๏ธ

ุงููุญุงุถุฑ ูุงู ุจุฅุถุงูุฉ ููุฒุงุช ูุซูุฑุฉ "ุฎูู ุงูููุงููุณ" (Off-Camera) ููู ููุชูู ุงููุดุฑูุนุ ูุงุณุชุนุฑุถูุง ุจุณุฑุนุฉ:

1. **ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**
    
    - **Rooms:** ุฅูุดุงุก ูุญุฐู ุงูุบุฑู.
        
    - **Gyms:** ุฅุถุงูุฉ ุฌููุ ุญุฐู ุฌููุ ูุฅุถุงูุฉ ูุฏุฑุจูู ููุฌูู.
        
    - **Delete Subscription:** ุญุฐู ุงูุงุดุชุฑุงู (ููุฐู ูููุง ููุฌูู ูุซูุฑ).
        
2. **ุณููุงุฑูู ุญุฐู ุงูุงุดุชุฑุงู (Delete Subscription Logic):** ๐๏ธ
    
    ูุฐุง ุงููุซุงู ููุถุญ ููุฉ **Unit of Work** ุจุฃุฌูู ุตูุฑุฉ.
    
    ุนูุฏูุง ูุญุฐู ุงุดุชุฑุงูุ ูุฌุจ ุฃู ูุญุฏุซ ุงูุชุงูู ุฏูุนุฉ ูุงุญุฏุฉ:
    
    1. ุญุฐู ุณุทุฑ ุงูุงุดุชุฑุงู ูู ุฌุฏูู `Subscriptions`.
        
    2. ุงูุฐูุงุจ ูุฌุฏูู `Admins` ูุชุตููุฑ ุญูู ุงูุงุดุชุฑุงู (`SubscriptionId = null`).
        
    3. ุงูุฐูุงุจ ูุฌุฏูู `Gyms` ูุญุฐู **ูู** ุงูุฌููุงุช ุงูุชุงุจุนุฉ ููุฐุง ุงูุงุดุชุฑุงู.
        
    
    **ุชุฎูู ูู ูุดูุช ุงูุฎุทูุฉ 3ุ**
    
    ุจุณุจุจ ุงูู Unit of Workุ ุงููุธุงู ุณูุชุฑุงุฌุน ุนู ุงูุฎุทูุฉ 1 ู 2ุ ููู ูุญุฐู ุงูุงุดุชุฑุงูุ ูุชุจูู ุงูุจูุงูุงุช ุณูููุฉ (Consistent).
    

---

### ุงูุฌุฒุก ุงูุฑุงุจุน: ูุงุฐุง ูููุตูุงุ (ุงูุฎุทูุงุช ุงููุงุฏูุฉ) ๐

ุฑุบู ุฃู ุงููุดุฑูุน ูุนููุ ุฅูุง ุฃูู ูุง ุฒุงู "ูุณุฎุฉ ุชุนููููุฉ" ููููุตู ุงููุซูุฑ ููููู **Production Ready**:

1. **Authentication & Authorization:** ๐
    
    ุญุงููุงู ุฃู ุดุฎุต ูุนู Postman ููุฏุฑ ูุญุฐู ุฃู ุงุดุชุฑุงู! ูุง ููุฌุฏ Login ููุง ุตูุงุญูุงุช.
    
2. **Error Handling (Middleware):** โ๏ธ
    
    ูุญู ูุฑุฌุน `Problem()` ูุฏููุงูุ ููู ูู ุญุฏุซ Exception ุบูุฑ ูุชููุนุ ุงูุณูุฑูุฑ ุณูุฑุฌุน HTML ูุจูุญ ุฃู ูููุงุฑ. ูุญุชุงุฌ Global Exception Handler.
    
3. **Validation:** โ
    
    ูุญู ูุชุญูู ูู ุงูู Enum ูุฏููุงูุ ููู ูุงุฐุง ุนู ุทูู ุงูุงุณูุ ุดูู ุงูุฅููููุ ูุญุชุงุฌ FluentValidation.
    
4. **User Management:** ๐ค
    
    ุงูู `AdminId` ุญุงููุงู ูู ูุฌุฑุฏ GUID ููููุ ูุง ููุฌุฏ ุฌุฏูู ูููุณุชุฎุฏููู ุงูุญูููููู ูุชุณุฌูู ุงูุฏุฎูู.
    

ูู ูุฐู ุงูููุงุถูุน ูู ูุญูุฑ ููุฑุณ **"Deep Dive into Clean Architecture"** ุงูุฐู ุฃุดุงุฑ ุฅููู ุงููุญุงุถุฑ.

---

### ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ ููููุฑุณ (Recap) ๐

ููุฏ ุจูููุง ูุธุงูุงู ูุงููุงู ูู ุงูุตูุฑ ุจุงุชุจุงุน **Clean Architecture**:

1. **Domain:** ุงูููุจ ุงููุงุจุถุ ูุญุชูู ุงูู Entities ูุงูู Logicุ ูุญูู ููุณุชูู.
    
2. **Application:** ุงููุงูุณุชุฑูุ ููุธู ุงูุนูููุงุช (Use Cases) ุจุงุณุชุฎุฏุงู CQRS & Mediator.
    
3. **Infrastructure:** ุงูุนูุงูุ ูููุฐูู ุงูุงุชุตุงู ุจุงูุฏุงุชุงุจูุณ (EF Core) ูุงููููุงุช.
    
4. **Presentation (API):** ุงููุงุฌูุฉุ ุชุณุชูุจู ุงูุทูุจุงุช ูุชุชููู ูุน ุงูุนุงูู ุงูุฎุงุฑุฌู.
    



---











### ุงูุฌุฒุก ุงูุฃูู: ูุธุฑุฉ ุดููููุฉ (Holistic View) ููุณุคูููุงุช ุงูุทุจูุงุช ๐

ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ ููุง ูู ุฃู "ููุน ุงูุฎุทุฃ" ูุนุชูุฏ ุนูู "ููุงู ุญุฏูุซู". ูู ุทุจูุฉ ููุง ููุทู ูุฎุชููุ ูุจุงูุชุงูู ููุง ุฃุฎุทุงุก ูุฎุชููุฉุ ููุณุคูููุฉ ูุฎุชููุฉ ูู ุงูุชุนุงูู ูุนูุง.

#### 1. ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer) - "ุงูุญุงุฑุณ ุงูุฎุงุฑุฌู" ๐ก๏ธ

ูุฐู ุงูุทุจูุฉ ูู ุฎุท ุงูุฏูุงุน ุงูุฃูู ูุงูุฃุฎูุฑ. ูู ุฃูู ูู ูุณุชูู ุงูุทูุจุ ูุขุฎุฑ ูู ููุฏุน ุงูุฑุฏ.

- **ุฃุฎุทุงุก ุงูุชุญููู (Conversion Errors):**
    
    ูุจู ุฃู ูุตู ููููุฏ ุงูุญููููุ ุงูุทุจูุฉ ุชุญุงูู ุชุญููู ุงูู JSON ุงููุงุฏู ุฅูู ูุบุฉ ุงููุธุงู (Commands/Queries).
    
    - _ูุซุงู:_ ุงููุณุชุฎุฏู ุฃุฑุณู ููุน ุงุดุชุฑุงู "SuperGold" ูุงููุธุงู ูุง ูุนุฑู ุฅูุง (Free, Starter, Pro).
        
    - _ุงูุฅุฌุฑุงุก:_ ุงูุทุจูุฉ ุชุฑูุถ ุงูุทูุจ ููุฑุงู ูุชุนูุฏ **400 Bad Request**. ูุง ุฏุงุนู ูุฅููุงุธ ุงูู Domain ูู ุงูููู ูู ุฃุฌู ุทูุจ ุบุจู.
        
- **ุฃุฎุทุงุก ุงููุฌูุฏ (Existence Errors):**
    
    ุงููุณุชุฎุฏู ูุญุงูู ุทูุจ Endpoint ุบูุฑ ููุฌูุฏ ุฃุตูุงู.
    
    - _ุงูุฅุฌุฑุงุก:_ ุฅุนุงุฏุฉ **404 Not Found**.
        
- **ุฃุฎุทุงุก ุงููุตุงุฏูุฉ (Authentication Errors):**
    
    ุงููุณุชุฎุฏู ูุญุงูู ุงูุฏุฎูู ููููุง ูุง ูุนุฑู "ูู ูู" (ูู ูุฑุณู Token ุฃู ุงูู Token ููุชูู).
    
    - _ุงูุฅุฌุฑุงุก:_ ุฅุนุงุฏุฉ **401 Unauthorized** ุฃู ุชุญูููู ูุตูุญุฉ ุงูุฏุฎูู.
        
- **ุงููุณุคูููุฉ ุงูููุงุฆูุฉ (Mapping):**
    
    ุญุชู ูู ุญุฏุซ ุงูุฎุทุฃ ูู ุฃุนูู ููุทุฉ ูู ุงูุฏููููุ ูุฅู ุทุจูุฉ ุงูุนุฑุถ ูู ุงููุณุคููุฉ ุนู "ุชุฌููู" ูุฐุง ุงูุฎุทุฃ ูุชุญูููู ูุดูุก ููููู ุงูุนููู (HTTP Status Code ุฃู View ุฌูููุฉ).
    

---

#### 2. ุทุจูุฉ ุงูุชุทุจูู (Application Layer) - "ุงูููุณู ูุงูุถุงุจุท" ๐ฎโโ๏ธ

ููุง ูุตูุช ุงูุจูุงูุงุช ุณูููุฉ ุดูููุงูุ ููููุง ูุจุฏุฃ ุจุงูุชุฏููู ูู "ุงูููุทู".

- **ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (Model Validation):**
    
    - _ูุซุงู:_ ุงุณู ุงูุฌูู ูุตู 15 ุญุฑูุงูุ ููู ุงููุธุงู ูุณูุญ ุจู 10 ููุท.
        
    - _ุงูุฎูุงุฑูู:_
        
        1. ุฅูุง ุฃู ูููู ูุฏููุง ูุงุฆู ุฏูููู ุงุณูู `GymName` ูุฑูุถ ุงูุฅูุดุงุก ุฅุฐุง ุฒุงุฏ ุงูุทูู (ููุฐุง ููู ูููุณุคูููุฉ ููุฏูููู).
            
        2. ุฃู (ููู ุงูุดุงุฆุน) ุฃู ุชููู ุทุจูุฉ ุงูุชุทุจูู ุจูุฐุง ุงููุญุต ูุชุฑุฌุน ุฎุทุฃ **Validation Error** ูุจู ุงุณุชุฏุนุงุก ุงูุฏูููู.
            
- **ุฃุฎุทุงุก ุงูุตูุงุญูุงุช (Authorization Errors):**
    
    ุงููุณุชุฎุฏู ูุนุฑูู (Authenticated)ุ ููู ูู ูุญู ูู ูุนู ูุฐุงุ
    
    - _ูุซุงู:_ ูุณุชุฎุฏู ูุญุงูู ุญุฐู ุงุดุชุฑุงู ููุณ ูููู.
        
    - _ุงูุฅุฌุฑุงุก:_ ุฅุฑุฌุงุน ุฎุทุฃ **Unauthorized** (ุฃู Forbidden). ูุฐู ูุณุคูููุฉ ุงูู Application ูุฃููุง ูู ูู ุชูุณู ุงูุนูููุฉ ูุชุนุฑู ูู ูู ุงููุณุชุฎุฏู ุงูุญุงูู.
        
- **ุงูุชุนุงูู ูุน ุงูุทุจูุงุช ุงููุฌุงูุฑุฉ (Mapping Errors):**
    
    ุทุจูุฉ ุงูุชุทุจูู ูู "ุงููุณูุท".
    
    - ุฅุฐุง ุฑูู ุงูุฏูููู ุฎุทุฃ "MaxGymsReached"ุ ุงูู Application ูุฏ ููุฑุฑ ุชุญูููู ูุฎุทุฃ ุขุฎุฑ ุฃู ุชูุฑูุฑู ููุง ูู.
        
    - ุฅุฐุง ุฑูุช ุงูู Infrastructure ุฎุทุฃ "DatabaseConnectionFailed" ุฃู "EntityNotFound" (ุฑุฌุน null)ุ ุงูู Application ูุณุคูู ุนู ุชุญููู ุงูู null ุฅูู ุฎุทุฃ ููููู ูุซู **NotFound Error**.
        

---

#### 3. ุทุจูุฉ ุงููุฌุงู (Domain Layer) - "ุญุงุฑุณ ุงูููุงููู ุงูุตุงุฑูุฉ" ๐ฐ

ููุง ูุง ููุฌุฏ ุชูุงูู. ุงูุฃุฎุทุงุก ููุง ุชุนูู ูุญุงููุฉ ููุณุฑ "ููุงููู ุงูุจูุฒูุณ" (Invariants).

- **ุฃุฎุทุงุก ุตุฑูุญุฉ ููุญุฏุฏุฉ (Explicit Domain Errors):**
    
    ูุฌุจ ุฃู ูููู ูุฏููุง ูุงุฆูุฉ ูุญุฏุฏุฉ ููุงุถุญุฉ ุจุงูุฃุฎุทุงุก ุงูุชู ูููู ุฃู ุชุญุฏุซ ููุง.
    
    - _ูุซุงู:_ "SubscriptionCannotHaveMoreThan3Gyms". ูุฐุง ููุณ ุฎุทุฃ ุชูููุ ูุฐุง ุฎุทุฃ ุจุฒูุณ.
        
- **ุชุทุจูู ุงูููุงููู (Enforcing Invariants):**
    
    ุงูู Invariants ูู ุญูุงุฆู ูุฌุจ ุฃู ุชููู ุตุญูุญุฉ ุฏุงุฆูุงู.
    
    - _ูุซุงู:_ ุฅุฐุง ุญุงููุช ุฅุถุงูุฉ ุบุฑูุฉ ุซุงููุฉ ูุงุดุชุฑุงู Freeุ ุงูุฏูููู ุณูุฑูุถ ููุฑูู ุฎุทุฃ.
        
- **ุฃุฎุทุงุก ุบูุฑ ูุชููุนุฉ (Unexpected Manipulation):**
    
    ุฅุฐุง ูุตู ููุฏูููู ุงุณู ุฌูู ุทููู 100 ุญุฑูุ ููุฐุง ูุนุชุจุฑ "ุฎุทุฃ ุบูุฑ ูุชููุน" ูู ุงูุฏููููุ ูุฃู ุงูููุฑูุถ ุงูุทุจูุงุช ุงูุฎุงุฑุฌูุฉ (Application/Presentation) ุชููู ููุชุฑุช ูุฐุง ุงููุฑุงุก. ุงูุฏูููู ููุง ุณูุฑูู ุฎุทุฃ "InvalidState" ุฃู ูุง ุดุงุจู.
    

---

### ุงูุฌุฒุก ุงูุซุงูู: ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุญูู ูู ุงูุชุฏูู (Flow Control Strategy) ๐ฆ

ููู ูููู ุงูุฎุทุฃ ูู ุงูุฏูููู (ูู ุงูุฃุณูู) ุฅูู ุงูู Presentation (ูู ุงูุฃุนูู)ุ ุงููุญุงุถุฑ ุดุฑุญ ุงุณุชุฑุงุชูุฌูุฉ **Exceptions** ูู ูุฐุง ุงูุฌุฒุก.

#### ุงุณุชุฑุงุชูุฌูุฉ ุงูุงุณุชุซูุงุกุงุช (Using Exceptions):

ูู ูุฐุง ุงูุฃุณููุจุ ุนูุฏูุง ููุชุดู ุงูุฏูููู ุฎุทุฃุ ูููู ุจุฑูู `Exception`.

1. **ูู ุงูุฏูููู:**
    
    ูุฑูู ุงุณุชุซูุงุก ุฎุงุต ููุญุฏุฏ ุฌุฏุงู: `throw new MaxGymsReachedException()`.
    
2. **ูู ุงูุชุทุจูู (Application Layer):**
    
    ููุง ูุญุฏุซ ุงูุฌุฏู:
    
    - **ุงูุฎูุงุฑ ุฃ:** ูุชุฑู ุงูุงุณุชุซูุงุก ููุฑ (Bubble up) ููุง ููุชูุทู.
        
    - **ุงูุฎูุงุฑ ุจ:** ูุถุน `try-catch`. ููุชูุท ุงุณุชุซูุงุก ุงูุฏููููุ ููุญููู ูุงุณุชุซูุงุก ุขุฎุฑ ูุฎุต ุงูู Application.
        
    - _ูุซุงู:_ ูุญุงูู ุฌูุจ ุงุดุชุฑุงู ูู ุงูู Repo. ุฅุฐุง ูู ูุฌุฏู (Infrastructure Error)ุ ูุฏ ููุชูุท ุงูุฎุทุฃ ูููุฑุฑ ุฅุฑุฌุงุน "Success" ูุงุฑุบ ุจุฏู ุงูุฎุทุฃุ ุฃู ูุฑูู "NotFoundException".
        
3. **ูู ุงูุนุฑุถ (Presentation Layer):**
    
    ูู ุงูููุงูุฉุ ูุฌุจ ุฃู ูููู ููุงู ููุงู (ุบุงูุจุงู Middleware) ููุชูุท ูุฐุง ุงูุงุณุชุซูุงุก ููุญููู ูู `400 Bad Request` ุฃู `409 Conflict`.
    

#### โ๏ธ ุนููุจ ูุฐุง ุงูุฃุณููุจ (ููุง ุฐูุฑ ุงููุญุงุถุฑ):

- **ุตุนูุจุฉ ุงูุชุชุจุน (Hard to Track):** ุงูุงุณุชุซูุงุก ูููุฒ ุนุจุฑ ุงูุทุจูุงุช. ุนูุฏูุง ุชุฑู `throw` ูู ุงูุฏููููุ ูุง ุชุนุฑู ูู ุณููุชูุทูุ ูู ูู ุงูู Applicationุ ุฃู ุงูู Presentationุ
    
- **ุบููุถ ุงูุชุฏูู:** ุงูููุฏ ูุตุจุญ ุบูุฑ ุฎุทู (Non-linear)ุ ููุตุนุจ ูุนุฑูุฉ ูุณุงุฑ ุงูุชูููุฐ ุจูุฌุฑุฏ ุงููุธุฑ ููููุฏุ ุฎุงุตุฉ ุฃู ูู ุทุจูุฉ ูู ูุดุฑูุน ูููุตู (DLL ูููุตู).
    

**ุงูุฎูุงุตุฉ:**

ูู ุทุจูุฉ ูุณุคููุฉ ุนู ุญูุงูุฉ ููุณูุง ูุนู ุชุฑุฌูุฉ ุฃุฎุทุงุก ุงูุทุจูุงุช ุงูุชู ุชุญุชูุง. ุงูุฏูููู ูุญูู ุงูุจูุฒูุณุ ุงูุชุทุจูู ูุญูู ุงูุชูุณูู ูุงูุตูุงุญูุงุชุ ูุงูุนุฑุถ ูุญูู ุงููุฏุฎูุงุช ููุชุฑุฌู ุงููุฎุฑุฌุงุช ูููุณุชุฎุฏู.



---










---

### ุงูุฌุฒุก ุงูุฃูู: ููุณูุฉ ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก (Result Pattern vs Exceptions) ๐ง

ุจุฏุฃ ุงููุญุงุถุฑ ุจุชูุถูุญ ุงููุฑู ุงูุฌููุฑู ุจูู ุทุฑููุชูู ููุชุนุงูู ูุน ุงูุฃุฎุทุงุก:

1. **ุงูุงุณุชุซูุงุกุงุช (Exceptions):** ุชุณุชุฎุฏู ููุฃุฎุทุงุก **ุบูุฑ ุงููุชููุนุฉ (Unexpected)** ููุท.
    
    - **ูุซุงู:** ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุนุทูุชุ ุฎุทุฃ ุจุฑูุฌู (Bug)ุ ุชุถุงุฑุจ ูู ุงูู GUIDs (ุดูุก ูุณุชุญูู ูุธุฑูุงู).
        
    - **ุงูุฅุฌุฑุงุก:** ูุฑูู `Exception` ููุชุฑู ุงูู Global Handler ููุณูู ููุนูุฏ 500 Internal Server Error.
        
2. **ููุท ุงููุชุงุฆุฌ (Result Pattern):** ูุณุชุฎุฏู ููุฃุฎุทุงุก **ุงููุชููุนุฉ (Expected)**.
    
    - **ูุซุงู:** ูุณุชุฎุฏู ุบูุฑ ููุฌูุฏุ ูููุฉ ูุฑูุฑ ุฎุงุทุฆุฉุ ูุญุงููุฉ ุฅุถุงูุฉ ุฌูู ููู ุงูุนุฏุฏ ุงููุณููุญ.
        
    - **ุงูุฅุฌุฑุงุก:** ูุง ูุฑูู Exceptionุ ุจู ูุนูุฏ "ูุงุฆู" (Object) ูุญุชูู ุนูู ุงูุฎุทุฃ. ูุฐุง ูุฌุนู ุงูููุฏ ุตุฑูุญุงู (Explicit) ูุณูู ุงูุชุชุจุน.
        

**ุงูุฎุทุฃ ุงูุดุงุฆุน:** ุงุณุชุฎุฏุงู ุงูู Result Pattern ููู ุดูุกุ ุฃู ุงุณุชุฎุฏุงู Exceptions ููู ุดูุก. ุงูุณุฑ ูู ุงูุชูุงุฒู.

---

### ุงูุฌุฒุก ุงูุซุงูู: ุชุทุจูู ุงูุฃุฎุทุงุก ูู ุงูุฏูููู (Domain Layer) ๐ฐ

ุฐูุจ ุงููุญุงุถุฑ ูุชุทุจูู ูุงุนุฏุฉ ุจูุฒูุณ: **"ุงูุงุดุชุฑุงู ุงููุฌุงูู (Free) ูุณูุญ ุจุฌูู ูุงุญุฏ ููุท"**.

#### 1. ุชุนุฑูู ุงูุฎุทุฃ ุจุดูู ูุฑูุฒู

ุจุฏูุงู ูู ูุชุงุจุฉ ุฑุณุงูุฉ ุงูุฎุทุฃ ูุฏููุงู ูู ูุฑุฉุ ุฃูุดุฃ ููุงุณ `SubscriptionErrors`:

- ูุญุชูู ุนูู `public static readonly Error`.
    
- ุงูุฎุทุฃ ูู ููุฏ ูููุฒ: `Subscription.CannotHaveMoreGymsThanSubscriptionAllows`.
    
- ููุตู ููุฑูุก: "A subscription cannot have more gyms...".
    
- **ุงููุงุฆุฏุฉ:** ุชูุญูุฏ ุงูุฃุฎุทุงุก ูู ููุงู ูุงุญุฏ ูุณูููุฉ ุตูุงูุชูุง.
    

#### 2. ุงูุชุญูู ุฏุงุฎู ุงูุฏูููู (Logic)

ูู ุฏุงูุฉ `AddGym` ุฏุงุฎู ููุงุณ `Subscription`:

- ูุชุญูู: ูู ุนุฏุฏ ุงูุฌููุงุช ุงูุญุงูู >= ุงูุญุฏ ุงููุณููุญุ
    
- ุฅุฐุง **ูุนู**: ูุนูุฏ `Error` (ุงููุนุฑู ุณุงุจูุงู) ุจุฏูุงู ูู ุฑูู Exception.
    
- ุฅุฐุง **ูุง**: ูุถูู ุงูุฌูู ูููุงุฆูุฉ.
    

#### 3. ุงูุชุนุงูู ูุน "ุงููุณุชุญููุงุช" (Exceptions)

ูุงุฐุง ูู ุงูุฌูู ููุฌูุฏ ุฃุตูุงู ูู ุงููุงุฆูุฉุ

- ุจูุง ุฃููุง ูุณุชุฎุฏู GUIDsุ ูุฐุง ุชุถุงุฑุจ "ูุณุชุญูู" ูุญุฏุซ ุทุจูุนูุงูุ ููุนุชุจุฑ ุฎูู ูู ุงููุธุงู.
    
- ูุฐูู ุงุณุชุฎุฏู `Throw.If(...)` ูุฑูู Exception ุญูููู. ูุฐุง ุฎุทุฃ ูุง ูุฑูุฏ ุฅุฎูุงุกู ุจู Resultุ ุจู ูุฑูุฏ ุฃู ูููุฌุฑ ุงููุธุงู ููุนุฑู ุจูุฌูุฏ ูุดููุฉ.
    

---

### ุงูุฌุฒุก ุงูุซุงูุซ: ุชุทุจูู ุงูุฃุฎุทุงุก ูู ุทุจูุฉ ุงูุชุทุจูู (Application Layer) ๐ฎโโ๏ธ

ูู ุงูู `CreateGymCommandHandler`ุ ูุญู "ุงูููุณู":

1. **ุงูุชุญูู ูู ุงููุฌูุฏ (Not Found):**
    
    - ูุฌูุจ ุงูุงุดุชุฑุงู ูู ุงูุฑูุจูุณุชูุฑู.
        
    - ุฅุฐุง ูุงู `null`ุ ูุนูุฏ `Error.NotFound`.
        
    - ูุงุญุธ: ูู ูุณุชุฎุฏู HTTP 404 ููุงุ ุจู ุงุณุชุฎุฏููุง ูุตุทูุญ ุนุงู `Error.NotFound`.
        
2. **ุงุณุชุฏุนุงุก ุงูุฏูููู:**
    
    - ููุงุฏู `subscription.AddGym()`.
        
    - ูุฐู ุงูุฏุงูุฉ ูุฏ ุชุนูุฏ "ูุฌุงุญ" ุฃู "ุฎุทุฃ ุจูุฒูุณ" (ูุซู ุชุฌุงูุฒ ุงูุนุฏุฏ).
        
    - ุงูู Application Layer ูุฃุฎุฐ ุงููุชูุฌุฉ ููุนูุฏูุง ููุง ูู ููุทุจูุฉ ุงูุฃุนูู.
        

---

### ุงูุฌุฒุก ุงูุฑุงุจุน: ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer) ูุงูู Base Controller ๐ฎ

ููุง ูุญุฏุซ ุงูุณุญุฑ ุงูุญูููู ูุชุฑุฌูุฉ ุงูุฃุฎุทุงุก ุฅูู ูุบุฉ ุงูููุจ (HTTP Status Codes).

#### 1. ุงูุชุนุงูู ูุน ุงูู Exceptions (Global Handler)

- ูู `Program.cs`ุ ุฃุถุงู `app.UseExceptionHandler()`.
    
- ูุฐุง Middleware ูุดุชุบู "ุดุจูุฉ ุฃูุงู". ุฅุฐุง ุญุฏุซ ุฃู Exception ุบูุฑ ูุชููุน (ูุซู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุทุงุฑุช)ุ ููุณูู ููุนูุฏ **500 Internal Server Error**.
    
- ูุฐุง ูุถูู ุฃู ุงูุณูุฑูุฑ ูุง ูููุงุฑ ุชูุงูุงู ุฃูุงู ุงููุณุชุฎุฏู.
    

#### 2. ุฅูุดุงุก `ApiController` (ูุงุนุฏุฉ ููู ุงูููุชุฑููุฑุฒ)

ุจุฏูุงู ูู ูุชุงุจุฉ ููุฏ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู ูู Controllerุ ุฃูุดุฃ ููุงุณ ุฃุจ `ApiController` ูุฑุซ ูู `ControllerBase`.

**ุฏุงูุฉ `Problem` ุงููุฎุตุตุฉ:**

ุฃูุดุฃ ุฏุงูุฉ ุชุณุชูุจู ูุงุฆูุฉ ุงูุฃุฎุทุงุก ูุชูุฑุฑ ุงูุชุงูู:

1. **ุฅุฐุง ูุงูุช Errors ูุงุฑุบุฉ:** ุชุนูุฏ 500 (ุดูุก ุบุฑูุจ).
    
2. **ุฅุฐุง ูุงูุช Validation Errors:** ุชุนูุฏ `ValidationProblem` (ุดูู ููุงุณู ููุฃุฎุทุงุก ุงููุชุนุฏุฏุฉ).
    
3. **ุฅุฐุง ูุงูุช ุฃุฎุทุงุก ุฃุฎุฑู:** ุชุฃุฎุฐ ุฃูู ุฎุทุฃ ูุชุนูู `switch` ุนูู ููุนู:
    
    - `ErrorType.Conflict` -> ุชุนูุฏ **409 Conflict**.
        
    - `ErrorType.Validation` -> ุชุนูุฏ **400 Bad Request**.
        
    - `ErrorType.NotFound` -> ุชุนูุฏ **404 Not Found**.
        
    - Default -> ุชุนูุฏ **500**.
        

#### 3. ุงูุชุทุจูู

- ุฌุนู ูู ุงูููุชุฑููุฑุฒ (`GymsController`, `SubscriptionsController`) ุชุฑุซ ูู `ApiController`.
    
- ุงูุขูุ ูู ุฃู ููุงูุ ููุชุจ ููุท: `return result.Match(..., errors => Problem(errors));`
    
- ูุงูุฏุงูุฉ `Problem` ูู ุงูุฃุจ ุชุชููู ุจูู "ูุฌุน ุงูุฑุฃุณ" ุงูุฎุงุต ุจุชุญููู ุงูุฎุทุฃ ุฅูู HTTP Code ููุงุณุจ.
    

---

### ุงูุฌุฒุก ุงูุฎุงูุณ: ุงูุชุฌุฑุจุฉ ุงูุนูููุฉ (Demo) ๐งช

ูุงู ุงููุญุงุถุฑ ุจุชุฌุฑุจุฉ ุงููุธุงู ููุชุฃูุฏ ูู ุงูุณูุงุจูุฉ ุงูุฃุฎุทุงุก:

1. **ุฅูุดุงุก ุฌูู (ูุฌุงุญ):** ุงูุงุดุชุฑุงู Freeุ ุฃุถุงู ุฌูู ูุงุญุฏ -> **201 Created**.
    
2. **ุฅุถุงูุฉ ุฌูู ุซุงูู (ูุดู ุจูุฒูุณ):** ุญุงูู ุฅุถุงูุฉ ุฌูู ุขุฎุฑ -> ุงูุฏูููู ุฑูุถ -> ุงูู Application ุฃุนุงุฏ ุงูุฎุทุฃ -> ุงูู Controller ุญููู ุฅูู **409 Conflict** (ุฃู ุญุณุจ ุงูุชุตููู) ูุน ุฑุณุงูุฉ ูุงุถุญุฉ.
    
3. **ุญุฐู ุดูุก ุบูุฑ ููุฌูุฏ (Not Found):** ุทูุจ ุญุฐู ุงุดุชุฑุงู ุบูุฑ ููุฌูุฏ -> ุงูู Application ุฃุนุงุฏ NotFound -> ุงูู Controller ุญููู ุฅูู **404 Not Found**.
    
4. **ุชูุฑุงุฑ ุงูุงุดุชุฑุงู (Conflict):** ุญุงูู ุฅูุดุงุก ุงุดุชุฑุงู ูุดุฎุต ูุฏูู ุงุดุชุฑุงู ุจุงููุนู -> **409 Conflict**.
    

---

### ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ ููููุฑุณ (Course Wrap-up) ๐

ูู ุงูุฏูุงุฆู ุงูุฃุฎูุฑุฉุ ูุฎุต ุงููุญุงุถุฑ ุงูุฑุญูุฉ ูุงููุฉ:

1. **ุดููููุฉ ุงููุธุฑุฉ:** ุชุนูููุง ููู ูุจูู ุงููุธุงู ูู "ุงูุญุงูุงุช ุงูุณุนูุฏุฉ" (Happy Path) ููู "ุญุงูุงุช ุงููุดู" (Error Flow).
    
2. **ุชูุฒูุน ุงููุณุคูููุงุช:**
    
    - **Presentation:** ุชุชููู HTTP ูุชุชุฑุฌู ุงููุฏุฎูุงุช/ุงููุฎุฑุฌุงุช.
        
    - **Application:** ุชูุณู ุงูุนูููุงุช ูุชุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช ูุงููุฌูุฏ.
        
    - **Domain:** ุชุญูู ููุงููู ุงูุจูุฒูุณ ูุชุนุฑู ุงูุฃุฎุทุงุก ุจุฏูุฉ.
        
    - **Infrastructure:** ุชููุฐ ุงูุงุชุตุงู ุจุงูุนุงูู ุงูุฎุงุฑุฌู.
        
3. **ูุตูุญุฉ ุฃุฎูุฑุฉ:** ุงููููู ุฃุฑููุชูุดุฑ ูุฏ ูุจุฏู ูุนูุฏุงู (High Cognitive Load) ูู ุงูุจุฏุงูุฉุ ูููู ุงุณุชุซูุงุฑ ูู ุงููุณุชูุจู. ุญูู ุงูุณูุฑุณ ููุฏุ ุฌุฑุจูุ ูุงูููู ุฌูุฏุงู.
    

ูุฎุชู ุจุฏุนูุชู ููููุฑุณ ุงููุชูุฏู **"Deep Dive into Clean Architecture"** ุงูุฐู ูุบุทู ุงูููุงุถูุน ุงูุชู ูู ูุณุนููุง ุงูููุช ููุง (ูุซู ุงูู Login ุงูุญููููุ ุงูู Validation ุงููุชูุฏูุ ูุงูู Microservices).